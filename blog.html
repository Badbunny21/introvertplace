<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Blog - Introvert Place</title>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,400;0,9..144,500;1,9..144,300;1,9..144,400&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-deep: #0a0c10;
      --bg-surface: #12151c;
      --bg-elevated: #1a1e28;
      --bg-hover: #242a36;
      --accent-warm: #e8a87c;
      --accent-soft: #c4a1ff;
      --accent-calm: #7cb8e8;
      --accent-green: #7ce8a8;
      --accent-gold: #f0e87c;
      --accent-rose: #e87c9a;
      --text-primary: #f0eeeb;
      --text-secondary: #9ca3af;
      --text-muted: #6b7280;
      --border-subtle: rgba(255,255,255,0.06);
      --border-light: rgba(255,255,255,0.1);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      --radius-full: 9999px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg-deep);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
      overflow-x: hidden;
    }

    h1, h2, h3, h4 { font-family: 'Fraunces', serif; font-weight: 400; }

    /* Layout */
    .app { min-height: 100vh; }
    .main { position: relative; min-height: 100vh; }

    /* Ambient */
    .ambient {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }
    .orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(120px);
      animation: drift 25s ease-in-out infinite;
    }
    .orb-1 {
      width: 500px; height: 500px;
      background: radial-gradient(circle, rgba(232,168,124,0.15) 0%, transparent 70%);
      top: -150px; right: -100px;
    }
    .orb-2 {
      width: 400px; height: 400px;
      background: radial-gradient(circle, rgba(196,161,255,0.12) 0%, transparent 70%);
      bottom: -100px; left: 10%;
      animation-direction: reverse;
    }
    @keyframes drift { 0%,100%{transform:translate(0,0);} 50%{transform:translate(30px,-30px);} }

    .content {
      position: relative;
      z-index: 1;
      padding: 40px 48px;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Header */
    .page-header { margin-bottom: 40px; }
    .page-header h1 {
      font-size: 42px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .page-header p { font-size: 18px; color: var(--text-secondary); }

    /* Tabs */
    .tabs { display: flex; gap: 8px; margin-bottom: 32px; flex-wrap: wrap; }
    .tab {
      padding: 12px 24px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-full);
      color: var(--text-secondary);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .tab:hover { background: var(--bg-elevated); color: var(--text-primary); }
    .tab.active {
      background: var(--accent-warm);
      color: var(--bg-deep);
      border-color: var(--accent-warm);
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.4s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Categories */
    .categories { display: flex; gap: 10px; margin-bottom: 32px; flex-wrap: wrap; }
    .category {
      padding: 8px 18px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-full);
      color: var(--text-muted);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .category:hover { color: var(--text-primary); border-color: var(--border-light); }
    .category.active { background: var(--bg-elevated); color: var(--text-primary); border-color: var(--accent-soft); }

    /* Featured */
    .featured {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-xl);
      overflow: hidden;
      margin-bottom: 40px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .featured:hover {
      border-color: var(--accent-warm);
      transform: translateY(-4px);
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    .featured-image {
      height: 300px;
      background: linear-gradient(135deg, rgba(232,168,124,0.3) 0%, rgba(196,161,255,0.2) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 80px;
      position: relative;
    }
    .featured-badge {
      position: absolute;
      top: 20px; left: 20px;
      padding: 8px 16px;
      background: var(--accent-warm);
      color: var(--bg-deep);
      border-radius: var(--radius-full);
      font-size: 12px;
      font-weight: 500;
    }
    .featured-content { padding: 32px; }
    .featured-meta {
      display: flex; align-items: center; gap: 16px;
      margin-bottom: 16px;
      font-size: 13px;
      color: var(--text-muted);
    }
    .featured-meta .category-tag {
      padding: 4px 12px;
      background: rgba(196,161,255,0.15);
      color: var(--accent-soft);
      border-radius: var(--radius-full);
    }
    .featured-content h2 { font-size: 32px; margin-bottom: 12px; line-height: 1.3; }
    .featured-content p { font-size: 16px; color: var(--text-secondary); line-height: 1.7; margin-bottom: 20px; }
    .featured-footer { display: flex; align-items: center; justify-content: space-between; }
    .author { display: flex; align-items: center; gap: 12px; }
    .author-avatar {
      width: 40px; height: 40px; border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex; align-items: center; justify-content: center; font-size: 18px;
    }
    .author-avatar img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
    .author-info { display: flex; flex-direction: column; }
    .author-name { font-size: 14px; font-weight: 500; }
    .author-date { font-size: 12px; color: var(--text-muted); }
    .reading-time {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 16px;
      background: var(--bg-elevated);
      border-radius: var(--radius-full);
      font-size: 13px;
      color: var(--text-secondary);
    }

    /* Articles */
    .articles-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 24px;
    }
    .article-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-xl);
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .article-card:hover { border-color: var(--border-light); transform: translateY(-4px); }
    .article-image {
      height: 180px;
      background: var(--bg-elevated);
      display: flex;
      align-items: center; justify-content: center;
      font-size: 48px; position: relative;
    }
    .article-type {
      position: absolute; top: 12px; right: 12px;
      padding: 6px 12px;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(8px);
      border-radius: var(--radius-full);
      font-size: 11px;
      color: var(--text-secondary);
    }
    .article-type.editorial { color: var(--accent-warm); }
    .article-type.community { color: var(--accent-green); }
    .article-body { padding: 24px; }
    .article-category {
      display: inline-block;
      padding: 4px 12px;
      background: rgba(124,184,232,0.15);
      color: var(--accent-calm);
      border-radius: var(--radius-full);
      font-size: 11px;
      margin-bottom: 12px;
    }
    .article-body h3 { font-size: 20px; margin-bottom: 10px; line-height: 1.4; }
    .article-body p {
      font-size: 14px; color: var(--text-secondary); line-height: 1.6; margin-bottom: 16px;
      display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;
    }
    .article-footer {
      display: flex; align-items: center; justify-content: space-between;
      padding-top: 16px; border-top: 1px solid var(--border-subtle);
    }
    .article-author { display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-muted); }
    .article-author-avatar {
      width: 28px; height: 28px; border-radius: 50%;
      background: var(--bg-elevated);
      display: flex; align-items: center; justify-content: center;
      font-size: 14px;
    }
    .article-author-avatar img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
    .article-meta { display: flex; align-items: center; gap: 12px; font-size: 12px; color: var(--text-muted); }
    .save-btn {
      background: none; border: none; color: var(--text-muted);
      font-size: 18px; cursor: pointer; transition: all 0.2s ease;
    }
    .save-btn:hover { color: var(--accent-gold); transform: scale(1.1); }
    .save-btn.saved { color: var(--accent-gold); }

    /* Write */
    .write-intro {
      text-align: center;
      padding: 60px 40px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-xl);
      margin-bottom: 40px;
    }
    .write-intro .intro-icon { font-size: 64px; margin-bottom: 20px; }
    .write-intro h2 { font-size: 32px; margin-bottom: 12px; }
    .write-intro p {
      font-size: 16px; color: var(--text-secondary);
      max-width: 500px; margin: 0 auto 28px; line-height: 1.7;
    }
    .write-btn {
      padding: 16px 36px;
      background: linear-gradient(135deg, var(--accent-warm) 0%, var(--accent-soft) 100%);
      border: none; border-radius: var(--radius-md);
      color: var(--bg-deep); font-size: 16px; font-weight: 500;
      cursor: pointer; transition: all 0.3s ease;
    }
    .write-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 30px rgba(232,168,124,0.3); }
    .write-btn.secondary {
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      color: var(--text-primary);
    }
    .write-btn.secondary:hover {
      background: var(--bg-hover);
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    .write-options {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      flex-wrap: wrap;
    }
    .write-divider {
      color: var(--text-muted);
      font-size: 14px;
    }

    /* Guidelines */
    .guidelines {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    .guideline-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: 28px;
    }
    .guideline-card .icon { font-size: 32px; margin-bottom: 16px; }
    .guideline-card h4 { font-size: 18px; margin-bottom: 8px; }
    .guideline-card p { font-size: 14px; color: var(--text-secondary); line-height: 1.6; }

    /* Drafts */
    .drafts-section { margin-top: 40px; }
    .section-title {
      font-size: 14px; text-transform: uppercase;
      letter-spacing: 0.15em; color: var(--text-muted); margin-bottom: 20px;
    }
    .draft-card {
      display: flex; align-items: center; gap: 20px;
      padding: 20px; background: var(--bg-surface);
      border: 1px solid var(--border-subtle); border-radius: var(--radius-lg);
      margin-bottom: 12px; cursor: pointer; transition: all 0.2s ease;
    }
    .draft-card:hover { background: var(--bg-elevated); }
    .draft-icon {
      width: 48px; height: 48px; background: var(--bg-elevated);
      border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;
      font-size: 24px;
    }
    .draft-info { flex: 1; }
    .draft-title { font-size: 16px; margin-bottom: 4px; }
    .draft-meta { font-size: 13px; color: var(--text-muted); }
    .draft-actions { display: flex; gap: 8px; }
    .draft-btn {
      padding: 8px 16px; background: var(--bg-elevated);
      border: 1px solid var(--border-subtle); border-radius: var(--radius-md);
      color: var(--text-secondary); font-size: 13px; cursor: pointer; transition: all 0.2s ease;
    }
    .draft-btn:hover { color: var(--text-primary); border-color: var(--border-light); }
    .draft-btn.primary { background: var(--accent-soft); color: var(--bg-deep); border: none; }

    /* Saved */
    .saved-empty {
      text-align: center;
      padding: 80px 40px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-xl);
    }
    .saved-empty .empty-icon { font-size: 64px; margin-bottom: 20px; opacity: 0.5; }
    .saved-empty h3 { font-size: 24px; margin-bottom: 12px; }
    .saved-empty p { font-size: 15px; color: var(--text-secondary); }

    /* Reading Modal */
    .reading-modal {
      position: fixed; inset: 0; z-index: 1000;
      background: var(--bg-deep);
      display: none; overflow-y: auto;
    }
    .reading-modal.active { display: block; }
    .reading-header {
      position: sticky; top: 0;
      background: var(--bg-deep);
      border-bottom: 1px solid var(--border-subtle);
      padding: 16px 40px;
      display: flex; align-items: center; justify-content: space-between;
      z-index: 10;
    }
    .close-reading {
      display: flex; align-items: center; gap: 8px;
      padding: 10px 20px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-full);
      color: var(--text-secondary);
      font-size: 14px;
      cursor: pointer; transition: all 0.2s ease;
    }
    .close-reading:hover { color: var(--text-primary); }
    .reading-actions { display: flex; gap: 12px; }
    .reading-action {
      width: 44px; height: 44px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 50%;
      color: var(--text-muted);
      font-size: 18px;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s ease;
    }
    .reading-action:hover { color: var(--text-primary); border-color: var(--border-light); }
    .reading-action.active { color: var(--accent-gold); }

    .reading-content {
      max-width: 720px;
      margin: 0 auto;
      padding: 20px 40px 100px;
    }
    .reading-content .category-tag {
      display: inline-block; padding: 6px 14px;
      background: rgba(196,161,255,0.15);
      color: var(--accent-soft);
      border-radius: var(--radius-full);
      font-size: 12px; margin-bottom: 20px;
    }
    .reading-content h1 { font-size: 42px; line-height: 1.3; margin-bottom: 24px; }
    .reading-meta {
      display: flex; align-items: center; gap: 24px;
      padding-bottom: 32px; border-bottom: 1px solid var(--border-subtle);
      margin-bottom: 40px;
    }
    .reading-meta .author { display: flex; align-items: center; gap: 12px; }
    .reading-meta .reading-time { margin-left: auto; }
    .article-text { font-size: 18px; line-height: 1.9; color: var(--text-secondary); }
    .article-text p { margin-bottom: 24px; }
    .article-text h2 { font-size: 28px; color: var(--text-primary); margin: 48px 0 20px; }
    .article-text blockquote {
      border-left: 3px solid var(--accent-warm);
      padding-left: 24px; margin: 32px 0;
      font-family: 'Fraunces', serif; font-size: 22px; font-style: italic; color: var(--text-primary);
    }

    /* Dynamic article content in reading modal ‚Äî immersive design */
    .article-hero {
      position: relative;
      padding: 80px 0 60px;
      margin-bottom: 48px;
    }
    .article-hero::before {
      content: '';
      position: absolute;
      top: 0; left: -100vw; right: -100vw;
      height: 100%;
      background: linear-gradient(180deg, rgba(196,161,255,0.08) 0%, rgba(124,184,232,0.04) 50%, transparent 100%);
      z-index: -1;
    }
    .article-hero::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0; right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--border-subtle), transparent);
    }

    .article-content .article-meta {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 28px;
      flex-wrap: wrap;
    }
    .article-content .article-category {
      padding: 6px 16px;
      background: linear-gradient(135deg, rgba(196,161,255,0.2), rgba(124,184,232,0.15));
      color: var(--accent-soft);
      border-radius: var(--radius-full);
      font-size: 12px;
      font-weight: 500;
      letter-spacing: 0.03em;
    }
    .article-content .article-date,
    .article-content .article-read-time {
      font-size: 13px;
      color: var(--text-muted);
    }
    .article-content .article-dot {
      width: 3px; height: 3px;
      border-radius: 50%;
      background: var(--text-muted);
    }
    .article-content .article-title {
      font-family: 'Fraunces', serif;
      font-size: 48px;
      line-height: 1.2;
      margin-bottom: 32px;
      color: var(--text-primary);
      letter-spacing: -0.02em;
    }
    .article-content .article-author {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .article-content .author-avatar-large {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      box-shadow: 0 4px 20px rgba(102,126,234,0.3);
    }
    .article-content .author-avatar-large img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
    .article-content .author-info {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }
    .article-content .author-name {
      font-size: 17px;
      font-weight: 500;
      color: var(--text-primary);
    }
    .article-content .author-tagline {
      font-size: 13px;
      color: var(--text-muted);
      font-style: italic;
    }
    .article-content .article-body {
      font-size: 19px;
      line-height: 1.9;
      color: var(--text-secondary);
    }
    .article-content .article-body p {
      margin-bottom: 28px;
    }
    .article-content .article-body p:first-child::first-letter {
      font-family: 'Fraunces', serif;
      font-size: 3.5em;
      float: left;
      line-height: 0.8;
      margin: 6px 14px 0 0;
      color: var(--accent-soft);
      font-weight: 400;
    }
    .article-content .article-body-end {
      text-align: center;
      margin: 60px 0 20px;
      color: var(--text-muted);
      font-size: 24px;
      letter-spacing: 16px;
    }

    /* Reactions */
    .quiet-reactions {
      display: flex; flex-direction: column; align-items: center;
      gap: 20px; padding: 48px 40px; margin-top: 60px;
      background: linear-gradient(180deg, transparent 0%, rgba(196,161,255,0.04) 100%);
      border-top: 1px solid var(--border-subtle);
      border-radius: 0 0 var(--radius-xl) var(--radius-xl);
    }
    .quiet-reactions p {
      font-family: 'Fraunces', serif;
      font-size: 18px;
      color: var(--text-secondary);
      font-style: italic;
    }
    .reactions-row { display: flex; gap: 16px; }
    .reaction-btn {
      width: 60px; height: 60px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 50%;
      font-size: 26px; cursor: pointer; transition: all 0.3s ease;
    }
    .reaction-btn:hover { transform: scale(1.15); border-color: var(--border-light); background: var(--bg-elevated); }
    .reaction-btn.selected {
      background: var(--bg-elevated);
      border-color: var(--accent-soft);
      box-shadow: 0 0 24px rgba(196,161,255,0.25);
      transform: scale(1.1);
    }

    /* Toast */
    .toast {
      position: fixed; bottom: 24px; left: 50%;
      transform: translateX(-50%) translateY(100px);
      padding: 14px 28px;
      background: var(--accent-green);
      color: var(--bg-deep);
      border-radius: var(--radius-full);
      font-size: 14px; font-weight: 500;
      opacity: 0; transition: all 0.3s ease; z-index: 1001;
    }
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

    /* Editor Modal */
    .editor-modal {
      position: fixed; inset: 0; z-index: 1000;
      background: var(--bg-deep);
      display: none; overflow-y: auto;
    }
    .editor-modal.active { display: block; }
    .editor-header {
      position: sticky; top: 0;
      background: var(--bg-deep);
      border-bottom: 1px solid var(--border-subtle);
      padding: 16px 40px;
      display: flex; align-items: center; justify-content: space-between;
      z-index: 10;
    }
    .close-editor {
      display: flex; align-items: center; gap: 8px;
      padding: 10px 20px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-full);
      color: var(--text-secondary);
      font-size: 14px;
      cursor: pointer; transition: all 0.2s ease;
    }
    .close-editor:hover { color: var(--text-primary); }
    .editor-actions { display: flex; gap: 12px; }
    .editor-btn {
      padding: 10px 24px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-full);
      color: var(--text-secondary);
      font-size: 14px;
      cursor: pointer; transition: all 0.2s ease;
    }
    .editor-btn:hover { color: var(--text-primary); border-color: var(--border-light); }
    .editor-btn.primary {
      background: linear-gradient(135deg, var(--accent-warm) 0%, var(--accent-soft) 100%);
      color: var(--bg-deep);
      border: none;
      font-weight: 500;
    }
    .editor-btn.primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(232,168,124,0.3); }

    .editor-content {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px;
    }
    .editor-field { margin-bottom: 24px; }
    .editor-field label {
      display: block;
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    .editor-title {
      width: 100%;
      background: transparent;
      border: none;
      font-family: 'Fraunces', serif;
      font-size: 36px;
      color: var(--text-primary);
      outline: none;
      padding: 12px 0;
      border-bottom: 2px solid var(--border-subtle);
      transition: border-color 0.2s ease;
    }
    .editor-title::placeholder { color: var(--text-muted); }
    .editor-title:focus { border-bottom-color: var(--accent-warm); }

    .category-select {
      display: flex; gap: 10px; flex-wrap: wrap;
    }
    .category-option {
      padding: 10px 20px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-full);
      color: var(--text-muted);
      font-size: 14px;
      cursor: pointer; transition: all 0.2s ease;
    }
    .category-option:hover { color: var(--text-primary); border-color: var(--border-light); }
    .category-option.selected {
      background: rgba(196,161,255,0.15);
      color: var(--accent-soft);
      border-color: var(--accent-soft);
    }

    .editor-textarea {
      width: 100%;
      min-height: 400px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: 24px;
      font-family: 'DM Sans', sans-serif;
      font-size: 17px;
      line-height: 1.8;
      color: var(--text-primary);
      outline: none;
      resize: vertical;
      transition: border-color 0.2s ease;
    }
    .editor-textarea::placeholder { color: var(--text-muted); }
    .editor-textarea:focus { border-color: var(--accent-soft); }

    .editor-tips {
      margin-top: 32px;
      padding: 20px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
    }
    .editor-tips h4 {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 12px;
      display: flex; align-items: center; gap: 8px;
    }
    .editor-tips ul {
      list-style: none;
      font-size: 14px;
      color: var(--text-muted);
    }
    .editor-tips li { padding: 6px 0; padding-left: 20px; position: relative; }
    .editor-tips li::before {
      content: '‚Ä¢';
      position: absolute;
      left: 0;
      color: var(--accent-soft);
    }

    /* Responsive */
    @media (max-width: 900px) {
      .content { padding: 24px; }
      .articles-grid { grid-template-columns: 1fr; }
      .featured-content h2 { font-size: 26px; }
      .reading-content { padding: 40px 24px; }
      .reading-content h1 { font-size: 32px; }
      .article-content .article-title { font-size: 34px; }
      .article-content .article-body { font-size: 17px; }
      .article-hero { padding: 50px 0 40px; }
    }
    @media (max-width: 600px) {
      .content { padding: 20px 16px; }
      .page-header h1 { font-size: 32px; }
      .tabs { overflow-x: auto; flex-wrap: nowrap; padding-bottom: 8px; }
      .featured-image { height: 200px; }
      .guidelines { grid-template-columns: 1fr; }
      .article-content .article-title { font-size: 28px; }
      .article-hero { padding: 30px 0 24px; }
      .article-content .article-meta { gap: 10px; }
      .reading-header { padding: 12px 16px; }
      .reading-actions { gap: 8px; }
      .reading-content { padding: 16px 16px 80px; }
      .reading-content h1 { font-size: 28px; }
    }
    @media (max-width: 380px) {
      .page-header h1 { font-size: 26px; }
      .reading-content h1 { font-size: 24px; }
    }
  </style>
</head>
<body>

  <div class="app">
    <main class="main">
      <div class="ambient">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
      </div>

      <div class="content">
        <header class="page-header">
          <h1>üìñ Blog</h1>
          <p>Thoughtful reads for quiet minds. Take your time.</p>
        </header>

        <div class="tabs">
          <button class="tab active" data-tab="discover">Discover</button>
          <button class="tab" data-tab="write">Write</button>
          <button class="tab" data-tab="saved">Saved</button>
        </div>

        <div class="tab-content active" id="tab-discover">
          <div class="categories">
            <button class="category active">All</button>
            <button class="category">Solitude</button>
            <button class="category">Creativity</button>
            <button class="category">Energy</button>
            <button class="category">Quiet Living</button>
            <button class="category">Deep Thoughts</button>
            <button class="category">Relationships</button>
          </div>

          <div class="empty-featured" style="padding: 60px; text-align: center; background: var(--bg-elevated); border-radius: 20px; border: 1px dashed var(--border-subtle);">
            <span style="font-size: 64px;">üìñ</span>
            <h2 style="margin-top: 16px; font-size: 24px;">No articles yet</h2>
            <p style="color: var(--text-secondary); margin-top: 8px; max-width: 400px; margin-left: auto; margin-right: auto;">Be the first to share your story! Articles from the community will appear here.</p>
            <button class="write-btn" style="margin-top: 24px;" onclick="openEditor(); loadDraft();">‚úçÔ∏è Start Writing</button>
          </div>

          <div class="articles-grid">
            <!-- Articles from the community will appear here -->
          </div>
        </div>

        <div class="tab-content" id="tab-write">
          <div class="write-intro">
            <div class="intro-icon">‚úçÔ∏è</div>
            <h2>Share Your Story</h2>
            <p>Your experiences matter. Write for fellow introverts who understand. No pressure to go viral ‚Äî just genuine connection through words.</p>
            <div class="write-options">
              <button class="write-btn" onclick="openEditor(); loadDraft();">Start Writing</button>
              <span class="write-divider">or</span>
              <button class="write-btn secondary" onclick="document.getElementById('fileUpload').click();">üìÑ Upload Existing</button>
              <input type="file" id="fileUpload" accept=".txt,.md,.doc,.docx" style="display: none;" onchange="handleFileUpload(event)">
            </div>
          </div>

          <div class="guidelines">
            <div class="guideline-card">
              <div class="icon">üí≠</div>
              <h4>Be Authentic</h4>
              <p>Share your real experiences. Vulnerability connects us more than perfection ever could.</p>
            </div>
            <div class="guideline-card">
              <div class="icon">üåø</div>
              <h4>Take Your Time</h4>
              <p>No deadlines, no pressure. Save drafts, revisit later. Publish when it feels right.</p>
            </div>
            <div class="guideline-card">
              <div class="icon">ü§ù</div>
              <h4>Respect & Support</h4>
              <p>This is a safe space. We lift each other up. No judgment, only understanding.</p>
            </div>
            <div class="guideline-card">
              <div class="icon">üìñ</div>
              <h4>Any Length Welcome</h4>
              <p>From short reflections to deep dives. Every story deserves to be told, however long it takes.</p>
            </div>
          </div>

          <div class="drafts-section">
            <div class="section-title">Your Drafts</div>
            <div style="padding: 24px; text-align: center; color: var(--text-muted); background: var(--bg-elevated); border-radius: 12px;">
              <span style="font-size: 32px;">‚úèÔ∏è</span>
              <p style="margin-top: 8px;">No drafts yet. Start writing and your work-in-progress will be saved here.</p>
            </div>
          </div>
        </div>

        <div class="tab-content" id="tab-saved">
          <div class="articles-grid" id="savedGrid">
            <!-- Saved articles will appear here -->
          </div>
          <div id="savedEmpty" style="text-align: center; padding: 60px 24px;">
            <span style="font-size: 48px;">üîñ</span>
            <h3 style="margin-top: 16px;">No saved articles</h3>
            <p style="color: var(--text-muted); margin-top: 8px;">Save articles with the üîñ bookmark icon when reading to find them here later</p>
          </div>
        </div>

      </div>
    </main>
  </div>

  <div class="reading-modal" id="readingModal">
    <div class="reading-header">
      <button class="close-reading" onclick="closeArticle()"><span>‚Üê</span> Back to Blog</button>
      <div class="reading-actions">
        <button class="reading-action" onclick="toggleSave(this)" title="Save for later">üîñ</button>
        <button class="reading-action" title="Share quietly">‚ÜóÔ∏è</button>
        <button class="reading-action delete-btn" id="deletePostBtn" onclick="deleteCurrentPost()" title="Delete post" style="display: none; background: rgba(232,124,154,0.2); color: #e87c9a;">üóëÔ∏è</button>
      </div>
    </div>
    <div class="reading-content">
      <div class="article-content">
        <!-- Dynamic content will be inserted here -->
      </div>
      <div class="quiet-reactions">
        <p>How did this resonate?</p>
        <div class="reactions-row">
          <button class="reaction-btn" onclick="selectReaction(this)">üåø</button>
          <button class="reaction-btn" onclick="selectReaction(this)">üíú</button>
          <button class="reaction-btn" onclick="selectReaction(this)">‚ú®</button>
          <button class="reaction-btn" onclick="selectReaction(this)">üôè</button>
        </div>
      </div>
    </div>
  </div>

  <div class="editor-modal" id="editorModal">
    <div class="editor-header">
      <button class="close-editor" onclick="closeEditor()"><span>‚Üê</span> Back to Blog</button>
      <div class="editor-actions">
        <button class="editor-btn" onclick="saveDraft()">Save Draft</button>
        <button class="editor-btn primary" onclick="publishPost()">Publish</button>
      </div>
    </div>
    <div class="editor-content">
      <div class="editor-field">
        <input type="text" class="editor-title" id="postTitle" placeholder="Your story title...">
      </div>

      <div class="editor-field">
        <label>Category</label>
        <div class="category-select">
          <button class="category-option" onclick="selectCategory(this)">Solitude</button>
          <button class="category-option" onclick="selectCategory(this)">Creativity</button>
          <button class="category-option" onclick="selectCategory(this)">Energy</button>
          <button class="category-option" onclick="selectCategory(this)">Quiet Living</button>
          <button class="category-option" onclick="selectCategory(this)">Deep Thoughts</button>
          <button class="category-option" onclick="selectCategory(this)">Relationships</button>
        </div>
      </div>

      <div class="editor-field">
        <label>Your Story</label>
        <textarea class="editor-textarea" id="postContent" placeholder="Start writing your story here... Take your time, there's no rush."></textarea>
      </div>

      <div class="editor-tips">
        <h4>üí° Writing Tips</h4>
        <ul>
          <li>Write from the heart ‚Äî authenticity resonates</li>
          <li>Use paragraphs to give readers breathing room</li>
          <li>Your draft auto-saves as you type</li>
          <li>Press Escape anytime to return to the blog</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <script>
    // Supabase initialization
    const SUPABASE_URL = 'https://inpziyxjznikinqqputz.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlucHppeXhqem5pa2lucXFwdXR6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0MzQ0MTcsImV4cCI6MjA4NDAxMDQxN30.5QoXaD5vNcuteEmwmo82l_OIklVbGGCRpNtV0PMuSyY';

    let db = null;
    let currentUser = null;

    try {
      db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    } catch (err) {
      console.error('Supabase init error:', err);
    }

    // Auth check
    async function initAuth() {
      if (!db) {
        console.log('No db connection');
        loadBlogPosts(); // Still load posts without auth
        return;
      }
      try {
        console.log('Checking auth session...');
        const { data: { session }, error } = await db.auth.getSession();
        console.log('Session result:', session, 'Error:', error);
        if (session) {
          currentUser = session.user;
          console.log('User logged in:', currentUser.id);
        } else {
          console.log('No session found');
        }
        // Always load posts regardless of auth
        loadBlogPosts();
      } catch (err) {
        console.error('Auth error:', err);
        loadBlogPosts(); // Still load posts on error
      }
    }

    // Also listen for auth state changes
    if (db) {
      db.auth.onAuthStateChange((event, session) => {
        console.log('Auth state changed:', event);
        if (session) {
          currentUser = session.user;
          console.log('User now logged in:', currentUser.id);
        } else {
          currentUser = null;
        }
      });
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', initAuth);
  </script>

  <script>
    document.querySelectorAll('.tab').forEach(tab => {
      tab.onclick = function() {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById('tab-' + this.dataset.tab).classList.add('active');
      };
    });

    // ========== AUTHOR PROFILES CACHE ==========
    let authorProfiles = {}; // user_id -> { username, avatar_emoji, avatar_bg, avatar_url }

    async function loadAuthorProfiles(posts) {
      if (!db || !posts || posts.length === 0) return;
      const userIds = [...new Set(posts.map(p => p.user_id).filter(Boolean))];
      if (userIds.length === 0) return;

      try {
        const { data: profiles } = await db
          .from('profiles')
          .select('id, username, avatar, avatar_emoji, avatar_bg, avatar_url')
          .in('id', userIds);

        if (profiles) {
          profiles.forEach(p => { authorProfiles[p.id] = p; });
        }
      } catch (err) {
        console.error('Load author profiles error:', err);
      }
    }

    function getAuthorAvatar(post) {
      const profile = authorProfiles[post.user_id];
      return profile?.avatar || profile?.avatar_emoji || post.author_avatar || 'üåô';
    }

    function getAuthorAvatarUrl(post) {
      const profile = authorProfiles[post.user_id];
      return profile?.avatar_url || null;
    }

    function getAuthorBg(post) {
      const profile = authorProfiles[post.user_id];
      return profile?.avatar_bg || 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
    }

    function getAuthorName(post) {
      const profile = authorProfiles[post.user_id];
      return profile?.username || post.author_name || 'Anonymous';
    }

    function renderAuthorAvatarHtml(post, cssClass) {
      const avatarUrl = getAuthorAvatarUrl(post);
      const emoji = getAuthorAvatar(post);
      const bg = getAuthorBg(post);
      if (avatarUrl) {
        return '<div class="' + cssClass + '" style="background:' + bg + '"><img src="' + avatarUrl + '" alt="" onerror="this.remove();this.parentElement.textContent=\'' + emoji.replace(/'/g, "\\'") + '\'"></div>';
      }
      return '<div class="' + cssClass + '" style="background: ' + bg + '; display: flex; align-items: center; justify-content: center; font-size: ' + (cssClass === 'author-avatar-large' ? '26' : '16') + 'px;">' + emoji + '</div>';
    }

    // ========== CATEGORY FILTERING ==========
    let activeCategory = 'All';
    let allPosts = []; // Cached posts for filtering

    document.querySelectorAll('.category').forEach(cat => {
      cat.onclick = function() {
        document.querySelectorAll('.category').forEach(c => c.classList.remove('active'));
        this.classList.add('active');
        activeCategory = this.textContent.trim();
        filterAndRenderPosts();
      };
    });

    function filterAndRenderPosts() {
      const articlesGrid = document.querySelector('#tab-discover .articles-grid');
      if (!articlesGrid) return;

      const filtered = activeCategory === 'All'
        ? allPosts
        : allPosts.filter(p => p.category && p.category.toLowerCase() === activeCategory.toLowerCase());

      if (filtered.length === 0) {
        articlesGrid.innerHTML = `
          <div style="grid-column: 1/-1; padding: 60px 24px; text-align: center;">
            <span style="font-size: 48px;">üì≠</span>
            <h3 style="margin-top: 16px;">No articles in "${escapeHtml(activeCategory)}"</h3>
            <p style="color: var(--text-muted); margin-top: 8px;">Be the first to write about this topic!</p>
          </div>
        `;
      } else {
        articlesGrid.innerHTML = filtered.map(post => renderPostCard(post)).join('');
      }
    }

    function renderPostCard(post) {
      const categoryIcons = {
        'deep thoughts': 'üí≠', 'growth': 'üå±', 'creativity': 'üé®',
        'relationships': 'üíú', 'solitude': 'üåô', 'energy': '‚ö°',
        'quiet living': 'üè°'
      };
      const icon = categoryIcons[(post.category || '').toLowerCase()] || 'üìù';
      const avatar = getAuthorAvatar(post);
      const avatarBg = getAuthorBg(post);
      const authorName = getAuthorName(post);

      return `
        <article class="article-card" onclick="openArticleById('${post.id}')">
          <div class="article-image" style="background: linear-gradient(135deg, var(--accent-soft) 0%, var(--accent-calm) 100%);">
            ${icon}
            <span class="article-type community">Community</span>
          </div>
          <div class="article-body">
            <span class="article-category">${escapeHtml(post.category || 'Story')}</span>
            <h3>${escapeHtml(post.title)}</h3>
            <p>${escapeHtml((post.content || '').substring(0, 150))}...</p>
            <div class="article-footer">
              <div class="article-author">
                ${renderAuthorAvatarHtml(post, 'article-author-avatar')}
                <span>${escapeHtml(authorName)}</span>
              </div>
              <span style="font-size: 12px; color: var(--text-muted);">${post.read_time || '3 min read'}</span>
            </div>
          </div>
        </article>
      `;
    }

    // ========== SAVE FOR LATER ==========
    function getSavedPosts() {
      try {
        return JSON.parse(localStorage.getItem('savedBlogPosts') || '[]');
      } catch { return []; }
    }

    function setSavedPosts(ids) {
      localStorage.setItem('savedBlogPosts', JSON.stringify(ids));
    }

    function toggleSave(btn) {
      if (!currentPostId) return;

      const saved = getSavedPosts();
      const idx = saved.indexOf(currentPostId);

      if (idx === -1) {
        saved.push(currentPostId);
        btn.classList.add('active');
        showToast('üîñ Saved for later');
      } else {
        saved.splice(idx, 1);
        btn.classList.remove('active');
        showToast('Removed from saved');
      }

      setSavedPosts(saved);
      renderSavedTab();
    }

    async function renderSavedTab() {
      const savedIds = getSavedPosts();
      const grid = document.getElementById('savedGrid');
      const emptyEl = document.getElementById('savedEmpty');

      if (savedIds.length === 0) {
        if (grid) grid.innerHTML = '';
        if (emptyEl) emptyEl.style.display = '';
        return;
      }

      // Get saved posts from cache or database
      const savedPosts = allPosts.filter(p => savedIds.includes(p.id));

      if (savedPosts.length === 0 && db) {
        // Fallback: load from database if not in cache
        try {
          const { data: posts } = await db
            .from('blog_posts')
            .select('*')
            .in('id', savedIds)
            .order('created_at', { ascending: false });

          if (posts && posts.length > 0) {
            grid.innerHTML = posts.map(post => renderPostCard(post)).join('');
            if (emptyEl) emptyEl.style.display = 'none';
            return;
          }
        } catch (err) {
          console.error('Load saved posts error:', err);
        }
      }

      if (savedPosts.length > 0) {
        grid.innerHTML = savedPosts.map(post => renderPostCard(post)).join('');
        if (emptyEl) emptyEl.style.display = 'none';
      } else {
        if (grid) grid.innerHTML = '';
        if (emptyEl) emptyEl.style.display = '';
      }
    }

    function openArticle() {
      document.getElementById('readingModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    function closeArticle() {
      document.getElementById('readingModal').classList.remove('active');
      document.body.style.overflow = '';
    }

    function selectReaction(btn) {
      document.querySelectorAll('.reaction-btn').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      showToast('üíú Thank you for your reaction');
    }

    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2500);
    }

    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById('tab-' + tabName).classList.add('active');
    }

    // Editor functions
    function openEditor() {
      document.getElementById('editorModal').classList.add('active');
      document.body.style.overflow = 'hidden';
      document.getElementById('postTitle').focus();
    }

    function closeEditor() {
      document.getElementById('editorModal').classList.remove('active');
      document.body.style.overflow = '';
    }

    // File upload handler
    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        let content = e.target.result;

        // Extract title from first line if it looks like a heading
        let title = '';
        const lines = content.split('\n');
        const firstLine = lines[0].trim();

        // Check for markdown heading or just use first line as title
        if (firstLine.startsWith('# ')) {
          title = firstLine.substring(2);
          content = lines.slice(1).join('\n').trim();
        } else if (firstLine.length > 0 && firstLine.length < 100) {
          title = firstLine;
          content = lines.slice(1).join('\n').trim();
        }

        // Open editor and populate with file content
        openEditor();
        document.getElementById('postTitle').value = title;
        document.getElementById('postContent').value = content;

        showToast('üìÑ File imported successfully');
      };

      reader.onerror = function() {
        showToast('Error reading file');
      };

      reader.readAsText(file);
      event.target.value = ''; // Reset input for re-upload
    }

    function selectCategory(btn) {
      document.querySelectorAll('.category-option').forEach(c => c.classList.remove('selected'));
      btn.classList.add('selected');
    }

    function saveDraft() {
      const title = document.getElementById('postTitle').value;
      const content = document.getElementById('postContent').value;
      const category = document.querySelector('.category-option.selected')?.textContent || '';

      if (!title && !content) {
        showToast('Nothing to save yet');
        return;
      }

      localStorage.setItem('blogDraft', JSON.stringify({ title, content, category, savedAt: new Date().toISOString() }));
      showToast('‚ú® Draft saved');
    }

    async function publishPost() {
      console.log('publishPost called');
      const title = document.getElementById('postTitle').value;
      const content = document.getElementById('postContent').value;
      const category = document.querySelector('.category-option.selected')?.textContent || '';

      console.log('Title:', title);
      console.log('Content length:', content?.length);
      console.log('Category:', category);

      if (!title.trim()) {
        showToast('Please add a title');
        return;
      }
      if (!content.trim()) {
        showToast('Please write some content');
        return;
      }
      if (!category) {
        showToast('Please select a category');
        return;
      }

      console.log('db:', db);
      console.log('currentUser:', currentUser);

      if (!db || !currentUser) {
        showToast('Please sign in to publish');
        return;
      }

      try {
        // Get user profile for author info
        let authorName = 'Anonymous';
        const { data: profile } = await db
          .from('profiles')
          .select('username, avatar, avatar_emoji')
          .eq('id', currentUser.id)
          .single();

        if (profile?.username) {
          authorName = profile.username;
        }

        // Save to blog_posts table
        console.log('Attempting to insert blog post...');
        const postData = {
          user_id: currentUser.id,
          title: title.trim(),
          content: content.trim(),
          category: category,
          author_name: authorName,
          author_avatar: profile?.avatar || profile?.avatar_emoji || 'üåô',
          read_time: Math.ceil(content.split(/\s+/).length / 200) + ' min read'
        };
        console.log('Post data:', postData);

        const { data, error } = await db
          .from('blog_posts')
          .insert(postData)
          .select();

        console.log('Insert result - data:', data, 'error:', error);

        if (error) {
          console.error('Publish error:', error);
          if (error.message && error.message.includes('does not exist')) {
            showToast('‚ö†Ô∏è Blog table needs setup - check console');
            console.log('Run this SQL in Supabase to create the blog_posts table');
          } else {
            showToast('‚ö†Ô∏è Error publishing: ' + error.message);
          }
          return;
        }

        showToast('üéâ Your story has been published!');
        localStorage.removeItem('blogDraft');

        document.getElementById('postTitle').value = '';
        document.getElementById('postContent').value = '';
        document.querySelectorAll('.category-option').forEach(c => c.classList.remove('selected'));

        setTimeout(() => {
          closeEditor();
          switchTab('discover');
          loadBlogPosts(); // Refresh the posts
        }, 1500);

      } catch (err) {
        console.error('Publish exception:', err);
        showToast('‚ö†Ô∏è Error publishing post');
      }
    }

    // Load and display blog posts
    async function loadBlogPosts() {
      if (!db) return;

      try {
        const { data: posts, error } = await db
          .from('blog_posts')
          .select('*')
          .order('created_at', { ascending: false })
          .limit(50);

        if (error) {
          console.log('Could not load posts:', error.message);
          return;
        }

        // Cache all posts for filtering
        allPosts = posts || [];

        const emptyState = document.querySelector('#tab-discover .empty-featured');

        if (allPosts.length === 0) {
          if (emptyState) emptyState.style.display = '';
          return;
        }

        if (emptyState) emptyState.style.display = 'none';

        // Fetch author profiles so avatars match their actual profile
        await loadAuthorProfiles(allPosts);

        // Render with current category filter
        filterAndRenderPosts();
        // Also render saved tab
        renderSavedTab();

      } catch (err) {
        console.error('Load posts error:', err);
      }
    }

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Track current post being viewed
    let currentPostId = null;

    // Delete current post (from header button)
    function deleteCurrentPost() {
      if (currentPostId) {
        deletePost(currentPostId);
      }
    }

    // Delete a blog post
    async function deletePost(postId) {
      if (!db || !currentUser) {
        showToast('Please sign in to delete');
        return;
      }

      if (!confirm('Are you sure you want to delete this post?')) {
        return;
      }

      try {
        const { error } = await db
          .from('blog_posts')
          .delete()
          .eq('id', postId)
          .eq('user_id', currentUser.id);

        if (error) {
          console.error('Delete error:', error);
          showToast('Error deleting post');
          return;
        }

        showToast('üóëÔ∏è Post deleted');
        closeArticle();
        loadBlogPosts();

      } catch (err) {
        console.error('Delete exception:', err);
        showToast('Error deleting post');
      }
    }

    // Open article by ID (for real posts from database)
    async function openArticleById(postId) {
      if (!db) return;

      try {
        const { data: post, error } = await db
          .from('blog_posts')
          .select('*')
          .eq('id', postId)
          .single();

        if (error || !post) {
          showToast('Could not load article');
          return;
        }

        // Populate the reading modal with post content
        const modal = document.getElementById('readingModal');
        const articleContent = modal.querySelector('.article-content');

        // Store current post ID for delete function
        currentPostId = post.id;

        // Check if this is the user's own post and show/hide delete button
        const isOwnPost = currentUser && post.user_id === currentUser.id;
        const deleteBtn = document.getElementById('deletePostBtn');
        if (deleteBtn) {
          deleteBtn.style.display = isOwnPost ? 'flex' : 'none';
        }

        // Fetch latest author profile
        if (post.user_id && !authorProfiles[post.user_id]) {
          await loadAuthorProfiles([post]);
        }
        const avatar = getAuthorAvatar(post);
        const avatarBg = getAuthorBg(post);
        const authorName = getAuthorName(post);

        if (articleContent) {
          articleContent.innerHTML = `
            <div class="article-hero">
              <div class="article-meta">
                <span class="article-category">${escapeHtml(post.category || 'Story')}</span>
                <span class="article-dot"></span>
                <span class="article-date">${new Date(post.created_at).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</span>
                <span class="article-dot"></span>
                <span class="article-read-time">${post.read_time || '3 min read'}</span>
              </div>
              <h1 class="article-title">${escapeHtml(post.title)}</h1>
              <div class="article-author">
                ${renderAuthorAvatarHtml(post, 'author-avatar-large')}
                <div class="author-info">
                  <span class="author-name">${escapeHtml(authorName)}</span>
                  <span class="author-tagline">Sharing their story</span>
                </div>
              </div>
            </div>
            <div class="article-body">
              ${post.content.split('\n').map(p => p.trim() ? `<p>${escapeHtml(p)}</p>` : '').join('')}
            </div>
            <div class="article-body-end">¬∑¬∑¬∑</div>
          `;
        }

        // Update save button state
        const saveBtn = modal.querySelector('.reading-action');
        if (saveBtn) {
          const isSaved = getSavedPosts().includes(post.id);
          saveBtn.classList.toggle('active', isSaved);
        }

        openArticle();

      } catch (err) {
        console.error('Open article error:', err);
        showToast('Error loading article');
      }
    }

    // Load draft on editor open
    function loadDraft() {
      const draft = localStorage.getItem('blogDraft');
      if (draft) {
        let parsed;
        try { parsed = JSON.parse(draft); } catch { return; }
        const { title, content, category } = parsed;
        document.getElementById('postTitle').value = title || '';
        document.getElementById('postContent').value = content || '';
        if (category) {
          document.querySelectorAll('.category-option').forEach(btn => {
            if (btn.textContent === category) btn.classList.add('selected');
          });
        }
      }
    }

    // Auto-save draft
    let autoSaveTimer;
    document.getElementById('postContent')?.addEventListener('input', () => {
      clearTimeout(autoSaveTimer);
      autoSaveTimer = setTimeout(saveDraft, 2000);
    });
    document.getElementById('postTitle')?.addEventListener('input', () => {
      clearTimeout(autoSaveTimer);
      autoSaveTimer = setTimeout(saveDraft, 2000);
    });

    // Update escape key handler
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeArticle();
        closeEditor();
      }
    });
  </script>
</body>
</html>

