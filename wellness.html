<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wellness - Introvert Place</title>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,400;0,9..144,500;1,9..144,300;1,9..144,400&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-deep: #0a0c10;
      --bg-surface: #12151c;
      --bg-elevated: #1a1e28;
      --bg-hover: #242a36;
      --accent-warm: #e8a87c;
      --accent-soft: #c4a1ff;
      --accent-calm: #7cb8e8;
      --accent-green: #7ce8a8;
      --accent-gold: #f0e87c;
      --text-primary: #f0eeeb;
      --text-secondary: #9ca3af;
      --text-muted: #6b7280;
      --border-subtle: rgba(255,255,255,0.06);
      --border-light: rgba(255,255,255,0.1);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      --radius-full: 9999px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg-deep);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }
    h1, h2, h3, h4 { font-family: 'Fraunces', serif; font-weight: 400; }

    /* Layout */
    .app-container { min-height: 100vh; }
    .main-content { min-height: 100vh; position: relative; }
    .wellness-ambient {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none; z-index: 0; overflow: hidden;
    }
    .wellness-ambient .orb-1 {
      position: absolute; width: 700px; height: 700px; border-radius: 50%;
      background: radial-gradient(circle, rgba(124,232,168,0.25) 0%, transparent 70%);
      filter: blur(120px); top: -250px; right: -150px;
      animation: floatSlow 30s ease-in-out infinite;
    }
    .wellness-ambient .orb-2 {
      position: absolute; width: 600px; height: 600px; border-radius: 50%;
      background: radial-gradient(circle, rgba(124,184,232,0.2) 0%, transparent 70%);
      filter: blur(120px); bottom: -200px; left: 10%;
      animation: floatSlow 25s ease-in-out infinite reverse;
    }
    .wellness-ambient .orb-3 {
      position: absolute; width: 400px; height: 400px; border-radius: 50%;
      background: radial-gradient(circle, rgba(196,161,255,0.15) 0%, transparent 70%);
      filter: blur(100px); top: 40%; left: 30%;
      animation: floatSlow 20s ease-in-out infinite;
    }
    @keyframes floatSlow {
      0%, 100% { transform: translate(0, 0) scale(1); }
      33% { transform: translate(40px, -40px) scale(1.05); }
      66% { transform: translate(-30px, 30px) scale(0.95); }
    }
    .content-wrapper {
      position: relative; z-index: 1;
      padding: 36px 48px; max-width: 1200px; margin: 0 auto;
    }

    /* Header */
    .wellness-header { text-align: center; margin-bottom: 40px; }
    .wellness-header h1 { font-size: 42px; font-weight: 300; margin-bottom: 12px; letter-spacing: -0.02em; }
    .wellness-header .tagline { font-size: 18px; color: var(--text-secondary); margin-bottom: 8px; }
    .wellness-header .subtitle { font-family: 'Fraunces', serif; font-size: 16px; font-style: italic; color: var(--text-muted); }

    /* Tabs */
    .wellness-tabs {
      display: flex; justify-content: center; gap: 14px; margin-bottom: 40px; flex-wrap: wrap;
    }
    .wellness-tab {
      display: flex; flex-direction: column; align-items: center; gap: 10px;
      padding: 22px 32px; background: var(--bg-surface); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg); cursor: pointer; transition: all 0.3s ease; min-width: 120px;
    }
    .wellness-tab:hover { background: var(--bg-elevated); transform: translateY(-2px); }
    .wellness-tab.active {
      border-color: var(--accent-green);
      background: rgba(124,232,168,0.08);
      box-shadow: 0 0 30px rgba(124,232,168,0.1);
    }
    .wellness-tab .tab-icon { font-size: 32px; }
    .wellness-tab .tab-label { font-size: 14px; color: var(--text-secondary); font-weight: 500; }
    .wellness-tab.active .tab-label { color: var(--text-primary); }

    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.4s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Overview */
    .status-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 32px; }
    .status-card { background: var(--bg-surface); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 24px; text-align: center; }
    .status-icon { font-size: 36px; margin-bottom: 12px; }
    .status-label { font-size: 13px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px; }
    .status-value { font-family: 'Fraunces', serif; font-size: 36px; margin-bottom: 12px; }
    .status-bar { height: 8px; background: var(--bg-elevated); border-radius: 4px; overflow: hidden; }
    .status-bar-fill { height: 100%; border-radius: 4px; transition: width 0.5s ease; }
    .status-bar-fill.energy { background: linear-gradient(90deg, var(--accent-calm), var(--accent-green)); }
    .status-bar-fill.social { background: linear-gradient(90deg, var(--accent-warm), var(--accent-gold)); }
    .status-bar-fill.stress { background: linear-gradient(90deg, var(--accent-soft), #ff8a8a); }

    .wellness-message {
      text-align: center; padding: 40px;
      background: linear-gradient(135deg, rgba(124,232,168,0.1) 0%, rgba(124,184,232,0.1) 100%);
      border: 1px solid rgba(124,232,168,0.2); border-radius: var(--radius-lg); margin-bottom: 32px;
    }
    .wellness-message .message-icon { font-size: 52px; margin-bottom: 16px; }
    .wellness-message h3 { font-size: 28px; color: var(--accent-green); margin-bottom: 10px; }
    .wellness-message p { font-size: 16px; color: var(--text-secondary); max-width: 500px; margin: 0 auto; line-height: 1.6; }

    .quick-tools { background: var(--bg-surface); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 28px; }
    .quick-tools h3 { font-size: 20px; margin-bottom: 20px; }
    .quick-tools-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
    .quick-tool-btn {
      display: flex; flex-direction: column; align-items: center; gap: 12px; padding: 28px 20px;
      background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: var(--radius-md);
      cursor: pointer; transition: all 0.3s ease;
    }
    .quick-tool-btn:hover { background: var(--bg-hover); border-color: var(--accent-green); transform: translateY(-4px); box-shadow: 0 8px 24px rgba(124,232,168,0.15); }
    .quick-tool-btn .tool-icon { font-size: 40px; }
    .quick-tool-btn .tool-label { font-size: 14px; color: var(--text-secondary); font-weight: 500; }

    /* Breathing */
    .breathing-section { max-width: 800px; margin: 0 auto; }
    .breathing-intro { text-align: center; margin-bottom: 36px; }
    .breathing-intro h2 { font-size: 28px; margin-bottom: 10px; }
    .breathing-intro p { font-size: 16px; color: var(--text-secondary); }
    .breathing-exercises { display: flex; flex-direction: column; gap: 18px; }
    .breathing-exercise-card {
      display: flex; justify-content: space-between; align-items: center;
      padding: 28px 32px; background: var(--bg-surface); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg); cursor: pointer; transition: all 0.3s ease;
    }
    .breathing-exercise-card:hover { border-color: var(--accent-green); transform: translateX(8px); box-shadow: 0 8px 32px rgba(124,232,168,0.12); }
    .exercise-info h4 { font-size: 20px; margin-bottom: 6px; }
    .exercise-info p { font-size: 14px; color: var(--text-secondary); }
    .exercise-meta { display: flex; align-items: center; gap: 20px; }
    .exercise-duration { font-size: 14px; color: var(--text-muted); display: flex; align-items: center; gap: 6px; }
    .exercise-start { padding: 12px 24px; background: var(--accent-green); color: var(--bg-deep); border: none; border-radius: var(--radius-md); font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; }
    .exercise-start:hover { transform: scale(1.05); box-shadow: 0 4px 16px rgba(124,232,168,0.4); }

    /* Battery */
    .battery-section { max-width: 900px; margin: 0 auto; }
    .battery-main-card {
      background: var(--bg-surface); border: 1px solid var(--border-subtle); border-radius: var(--radius-xl);
      padding: 40px; text-align: center; margin-bottom: 32px;
    }
    .battery-visual { position: relative; width: 200px; height: 100px; margin: 0 auto 24px; }
    .battery-body {
      width: 180px; height: 90px; background: var(--bg-elevated); border: 3px solid var(--border-light);
      border-radius: 12px; position: relative; overflow: hidden;
    }
    .battery-body::after {
      content: ''; position: absolute; right: -14px; top: 50%; transform: translateY(-50%);
      width: 10px; height: 40px; background: var(--border-light); border-radius: 0 4px 4px 0;
    }
    .battery-level {
      position: absolute; bottom: 4px; left: 4px; right: 4px;
      background: linear-gradient(to top, var(--accent-warm), var(--accent-gold));
      border-radius: 6px; transition: height 0.5s ease;
    }
    .battery-percentage { font-family: 'Fraunces', serif; font-size: 56px; margin-bottom: 8px; }
    .battery-status { font-size: 18px; color: var(--text-secondary); margin-bottom: 24px; }
    .battery-estimate {
      display: inline-flex; align-items: center; gap: 10px; padding: 12px 24px;
      background: var(--bg-elevated); border-radius: var(--radius-full); font-size: 14px; color: var(--text-secondary);
    }
    .drains-section {
      background: var(--bg-surface); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg);
      padding: 28px; margin-bottom: 24px;
    }
    .drains-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .drains-header h3 { font-size: 20px; }
    .log-drain-btn {
      padding: 10px 20px; background: var(--bg-elevated); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md); color: var(--text-secondary); font-size: 14px; cursor: pointer; transition: all 0.2s ease;
    }
    .log-drain-btn:hover { background: var(--bg-hover); color: var(--text-primary); }
    .drains-list { display: flex; flex-direction: column; gap: 12px; }
    .drain-item {
      display: flex; align-items: center; gap: 16px; padding: 16px 20px;
      background: var(--bg-elevated); border-radius: var(--radius-md);
    }
    .drain-icon { font-size: 28px; }
    .drain-details { flex: 1; }
    .drain-name { font-size: 15px; font-weight: 500; margin-bottom: 4px; }
    .drain-time { font-size: 13px; color: var(--text-muted); }
    .drain-impact {
      padding: 6px 14px; background: rgba(232,168,124,0.15);
      border-radius: var(--radius-full); font-size: 14px; color: var(--accent-warm); font-weight: 500;
    }
    .predictions-card {
      background: linear-gradient(135deg, rgba(196,161,255,0.1) 0%, rgba(232,168,124,0.1) 100%);
      border: 1px solid rgba(196,161,255,0.2); border-radius: var(--radius-lg); padding: 24px;
    }
    .predictions-card h3 { font-size: 18px; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
    .prediction-item {
      display: flex; align-items: flex-start; gap: 12px; padding: 14px 0; border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .prediction-item:last-child { border-bottom: none; padding-bottom: 0; }
    .prediction-icon { font-size: 20px; }
    .prediction-text { font-size: 14px; color: var(--text-secondary); line-height: 1.5; }
    .prediction-text strong { color: var(--text-primary); }

    /* Grounding */
    .grounding-section { max-width: 800px; margin: 0 auto; }
    .grounding-intro { text-align: center; margin-bottom: 36px; }
    .grounding-intro h2 { font-size: 28px; margin-bottom: 10px; }
    .grounding-intro p { font-size: 16px; color: var(--text-secondary); }
    .grounding-card {
      background: var(--bg-surface); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-xl); padding: 40px; text-align: center; margin-bottom: 24px;
    }
    .grounding-card h3 { font-size: 28px; margin-bottom: 10px; }
    .grounding-card > p { font-size: 16px; color: var(--text-secondary); margin-bottom: 32px; }
    .grounding-steps { display: flex; flex-direction: column; gap: 14px; max-width: 400px; margin: 0 auto 32px; }
    .grounding-step {
      display: flex; align-items: center; gap: 16px; padding: 18px 24px;
      background: var(--bg-elevated); border-radius: var(--radius-md); text-align: left; transition: all 0.2s ease;
    }
    .grounding-step:hover { background: var(--bg-hover); transform: translateX(4px); }
    .step-number {
      width: 44px; height: 44px; background: linear-gradient(135deg, var(--accent-green), var(--accent-calm));
      color: var(--bg-deep); border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-family: 'Fraunces', serif; font-size: 22px; font-weight: 500; flex-shrink: 0;
    }
    .step-text { font-size: 16px; }
    .step-text .sense { color: var(--accent-green); font-weight: 600; }
    .btn-primary {
      padding: 16px 36px; background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-calm) 100%);
      color: var(--bg-deep); border: none; border-radius: var(--radius-md); font-size: 16px; font-weight: 500;
      cursor: pointer; transition: all 0.2s ease;
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(124,232,168,0.3); }
    .other-techniques { display: grid; grid-template-columns: repeat(2, 1fr); gap: 18px; }
    .technique-card {
      padding: 24px; background: var(--bg-surface); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg); cursor: pointer; transition: all 0.3s ease;
    }
    .technique-card:hover { border-color: var(--accent-soft); transform: translateY(-4px); }
    .technique-card h4 { font-size: 18px; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; }
    .technique-card p { font-size: 14px; color: var(--text-secondary); line-height: 1.5; }

    /* Recovery */
    .recovery-section { max-width: 800px; margin: 0 auto; }
    .recovery-hero {
      text-align: center; padding: 60px 40px;
      background: linear-gradient(135deg, rgba(124,184,232,0.1) 0%, rgba(196,161,255,0.1) 100%);
      border: 1px solid rgba(124,184,232,0.2); border-radius: var(--radius-xl);
      margin-bottom: 32px;
    }
    .hero-icon { font-size: 64px; margin-bottom: 20px; }
    .recovery-hero h2 { font-size: 32px; margin-bottom: 12px; }
    .recovery-hero p { font-size: 18px; color: var(--text-secondary); max-width: 500px; margin: 0 auto 24px; line-height: 1.6; }
    .recovery-toggle {
      display: inline-flex; align-items: center; gap: 12px; padding: 14px 28px;
      background: var(--bg-surface); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-full); cursor: pointer; transition: all 0.3s ease;
    }
    .recovery-toggle:hover { background: var(--bg-elevated); }
    .recovery-toggle.active { background: rgba(124,232,168,0.15); border-color: var(--accent-green); }
    .toggle-switch {
      width: 48px; height: 26px; background: var(--bg-elevated); border-radius: var(--radius-full);
      position: relative; transition: all 0.3s ease;
    }
    .toggle-switch::after {
      content: ''; position: absolute; width: 20px; height: 20px; background: var(--text-muted);
      border-radius: 50%; top: 3px; left: 3px; transition: all 0.3s ease;
    }
    .recovery-toggle.active .toggle-switch { background: var(--accent-green); }
    .recovery-toggle.active .toggle-switch::after { left: 25px; background: var(--bg-deep); }
    .recovery-tools { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
    .recovery-tool-card {
      padding: 28px; background: var(--bg-surface); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg); cursor: pointer; transition: all 0.3s ease;
    }
    .recovery-tool-card:hover { border-color: var(--accent-calm); transform: translateY(-4px); }
    .recovery-tool-card .tool-icon { font-size: 40px; margin-bottom: 16px; }
    .recovery-tool-card h4 { font-size: 20px; margin-bottom: 8px; }
    .recovery-tool-card p { font-size: 14px; color: var(--text-secondary); line-height: 1.5; margin-bottom: 12px; }
    .recovery-tool-card .tool-time { font-size: 13px; color: var(--text-muted); }

    /* Breathing Modal */
    .breathing-modal { position: fixed; inset: 0; z-index: 1000; display: none; align-items: center; justify-content: center; }
    .breathing-modal.active { display: flex; }
    .modal-overlay { position: absolute; inset: 0; background: rgba(10,12,16,0.95); backdrop-filter: blur(20px); }
    .modal-content { position: relative; width: 100%; max-width: 600px; padding: 60px 40px; text-align: center; }
    .close-modal {
      position: fixed; top: 20px; right: 20px; width: 56px; height: 56px;
      background: var(--bg-surface); border: 2px solid var(--border-light); border-radius: 50%;
      color: var(--text-primary); font-size: 28px; cursor: pointer; display: flex; align-items: center; justify-content: center;
      transition: all 0.2s ease; z-index: 1001; box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }
    .close-modal:hover { background: var(--accent-green); color: var(--bg-deep); border-color: var(--accent-green); transform: scale(1.1); }
    .breath-visualization { position: relative; width: 280px; height: 280px; margin: 0 auto 40px; }
    .breath-circle-outer {
      position: absolute; inset: 0; border-radius: 50%;
      background: linear-gradient(135deg, rgba(124,232,168,0.2) 0%, rgba(124,184,232,0.2) 100%);
      transition: transform 8s ease-in-out;
    }
    .breath-circle-middle {
      position: absolute; inset: 30px; border-radius: 50%;
      background: linear-gradient(135deg, rgba(124,232,168,0.3) 0%, rgba(124,184,232,0.3) 100%);
      transition: transform 8s ease-in-out;
    }
    .breath-circle-inner {
      position: absolute; inset: 60px; border-radius: 50%;
      background: var(--bg-surface); display: flex; flex-direction: column; align-items: center; justify-content: center;
      border: 2px solid rgba(124,232,168,0.3);
    }
    .breath-text { font-family: 'Fraunces', serif; font-size: 24px; margin-bottom: 8px; transition: all 0.3s ease; }
    .breath-count { font-size: 48px; font-family: 'Fraunces', serif; color: var(--accent-green); }
    .breath-visualization.inhale .breath-circle-outer,
    .breath-visualization.inhale .breath-circle-middle { transform: scale(1.15); }
    .breath-visualization.hold .breath-circle-outer,
    .breath-visualization.hold .breath-circle-middle { transform: scale(1.15); }
    .breath-visualization.exhale .breath-circle-outer,
    .breath-visualization.exhale .breath-circle-middle { transform: scale(1); }

    .exercise-title { font-size: 28px; margin-bottom: 12px; }
    .exercise-description { font-size: 16px; color: var(--text-secondary); margin-bottom: 32px; }
    .breath-steps-display { display: flex; justify-content: center; gap: 32px; margin-bottom: 40px; }
    .breath-step-item { display: flex; flex-direction: column; align-items: center; gap: 8px; opacity: 0.4; transition: all 0.3s ease; }
    .breath-step-item.active { opacity: 1; }
    .breath-step-number {
      width: 56px; height: 56px; background: var(--bg-surface); border: 2px solid var(--border-subtle);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-family: 'Fraunces', serif; font-size: 28px; transition: all 0.3s ease;
    }
    .breath-step-item.active .breath-step-number { border-color: var(--accent-green); background: rgba(124,232,168,0.1); color: var(--accent-green); }
    .breath-step-label { font-size: 14px; color: var(--text-muted); }
    .breath-step-item.active .breath-step-label { color: var(--text-primary); }

    .breathing-controls { display: flex; flex-direction: column; gap: 16px; align-items: center; }
    .btn-breathing {
      padding: 18px 48px; background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-calm) 100%);
      color: var(--bg-deep); border: none; border-radius: var(--radius-md);
      font-size: 18px; font-weight: 500; cursor: pointer; transition: all 0.2s ease;
    }
    .btn-breathing:hover { transform: scale(1.05); box-shadow: 0 8px 32px rgba(124,232,168,0.4); }
    .btn-breathing:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .soundscape-toggle {
      display: flex; align-items: center; gap: 10px; padding: 12px 20px;
      background: var(--bg-surface); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md); color: var(--text-secondary); font-size: 14px;
      cursor: pointer; transition: all 0.2s ease;
    }
    .soundscape-toggle:hover { background: var(--bg-elevated); }
    .soundscape-toggle.active {
      background: rgba(124,232,168,0.15);
      border-color: var(--accent-green);
      color: var(--accent-green);
    }
    .cycle-counter { font-size: 15px; color: var(--text-muted); margin-top: 20px; }
    .completion-message {
      display: none; padding: 32px; background: rgba(124,232,168,0.1);
      border: 1px solid rgba(124,232,168,0.2); border-radius: var(--radius-lg); margin-top: 24px;
    }
    .completion-message.show { display: block; animation: fadeIn 0.5s ease; }
    .completion-message h4 { font-size: 22px; color: var(--accent-green); margin-bottom: 8px; }
    .completion-message p { font-size: 15px; color: var(--text-secondary); }

    /* Grounding Exercise Modal */
    .grounding-exercise-display {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 24px;
      padding: 20px 0;
    }
    .grounding-sense-icon {
      width: 120px; height: 120px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 56px;
      transition: all 0.5s ease;
      box-shadow: 0 0 60px rgba(124,232,168,0.2);
    }
    .grounding-sense-count {
      font-family: 'Fraunces', serif;
      font-size: 64px;
      font-weight: 300;
      color: var(--text-primary);
      line-height: 1;
    }
    .grounding-sense-label {
      font-size: 22px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.15em;
    }
    .grounding-prompt {
      font-size: 17px;
      color: var(--text-secondary);
      line-height: 1.6;
      max-width: 400px;
      margin: 0 auto;
    }
    .grounding-progress {
      display: flex;
      gap: 10px;
      margin-top: 8px;
    }
    .grounding-progress-dot {
      width: 12px; height: 12px;
      border-radius: 50%;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      transition: all 0.3s ease;
    }
    .grounding-progress-dot.done {
      background: var(--accent-green);
      border-color: var(--accent-green);
    }
    .grounding-progress-dot.active {
      background: var(--accent-soft);
      border-color: var(--accent-soft);
      box-shadow: 0 0 12px rgba(196,161,255,0.4);
      transform: scale(1.2);
    }
    .btn-grounding-next {
      padding: 16px 48px;
      background: linear-gradient(135deg, var(--accent-soft) 0%, var(--accent-calm) 100%);
      color: var(--bg-deep);
      border: none; border-radius: var(--radius-md);
      font-size: 16px; font-weight: 500;
      cursor: pointer; transition: all 0.2s ease;
    }
    .btn-grounding-next:hover { transform: scale(1.05); box-shadow: 0 8px 32px rgba(196,161,255,0.3); }
    .grounding-completion {
      display: none;
      text-align: center;
      padding: 40px 20px;
    }
    .grounding-completion.show { display: block; animation: fadeIn 0.5s ease; }
    .grounding-completion h3 { font-size: 28px; color: var(--accent-green); margin-bottom: 12px; }
    .grounding-completion p { font-size: 16px; color: var(--text-secondary); line-height: 1.6; max-width: 400px; margin: 0 auto; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Responsive */
    @media (max-width: 1100px) {
      .status-grid { grid-template-columns: 1fr; }
      .quick-tools-grid { grid-template-columns: repeat(2, 1fr); }
      .other-techniques, .recovery-tools { grid-template-columns: 1fr; }
    }
    @media (max-width: 900px) {
      .content-wrapper { padding: 24px; }
      .wellness-tabs { gap: 10px; }
      .wellness-tab { padding: 16px 20px; min-width: auto; }
      .wellness-tab .tab-icon { font-size: 28px; }
      .wellness-tab .tab-label { font-size: 12px; }
    }
    @media (max-width: 600px) {
      .content-wrapper { padding: 20px 16px; }
      .wellness-header h1 { font-size: 32px; }
      .quick-tools-grid { grid-template-columns: 1fr; }
      .breathing-exercise-card { flex-direction: column; align-items: flex-start; gap: 16px; }
      .exercise-meta { width: 100%; justify-content: space-between; }
      .breath-steps-display { gap: 20px; }
      .breath-step-number { width: 44px; height: 44px; font-size: 22px; }
    }

    /* Theme Variations */
    .theme-darker {
      --bg-deep: #000000;
      --bg-surface: #08090c;
      --bg-elevated: #0c0d12;
    }
    .theme-light {
      --bg-deep: #f8fafc;
      --bg-surface: #ffffff;
      --bg-elevated: #f1f5f9;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      --border-subtle: rgba(0,0,0,0.06);
      --border-light: rgba(0,0,0,0.1);
    }

    /* Font Size Variations */
    .font-small { font-size: 14px; }
    .font-large { font-size: 18px; }

    /* Reduce Motion */
    .reduce-motion, .reduce-motion * {
      animation-duration: 0.01ms !important;
      transition-duration: 0.01ms !important;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <main class="main-content">
      <div class="wellness-ambient">
        <div class="orb-1"></div><div class="orb-2"></div><div class="orb-3"></div>
      </div>
      <div class="content-wrapper">
        <header class="wellness-header">
          <h1>üåø Wellness</h1>
          <p class="tagline">Nervous system care. Body-first support. Gentle restoration.</p>
          <p class="subtitle">Take what you need, leave what you don't.</p>
        </header>

        <div class="wellness-tabs">
          <button class="wellness-tab active" onclick="switchToTab('overview')"><span class="tab-icon">üåø</span><span class="tab-label">Overview</span></button>
          <button class="wellness-tab" onclick="switchToTab('breathing')"><span class="tab-icon">ü´Å</span><span class="tab-label">Breathing</span></button>
          <button class="wellness-tab" onclick="switchToTab('battery')"><span class="tab-icon">üîã</span><span class="tab-label">Social Battery</span></button>
          <button class="wellness-tab" onclick="switchToTab('grounding')"><span class="tab-icon">üå±</span><span class="tab-label">Grounding</span></button>
          <button class="wellness-tab" onclick="switchToTab('recovery')"><span class="tab-icon">üõ°Ô∏è</span><span class="tab-label">Recovery</span></button>
        </div>

        <div class="tab-content active" id="tab-overview">
          <div class="status-grid">
            <div class="status-card"><div class="status-icon">‚ö°</div><div class="status-label">Energy Level</div><div class="status-value">--/10</div><div class="status-bar"><div class="status-bar-fill energy" style="width:0%"></div></div></div>
            <div class="status-card"><div class="status-icon">üîã</div><div class="status-label">Social Battery</div><div class="status-value">100%</div><div class="status-bar"><div class="status-bar-fill social" style="width:100%"></div></div></div>
            <div class="status-card"><div class="status-icon">üòÆ‚Äçüí®</div><div class="status-label">Stress Level</div><div class="status-value">--/10</div><div class="status-bar"><div class="status-bar-fill stress" style="width:0%"></div></div></div>
          </div>

          <div class="wellness-message">
            <div class="message-icon">‚ú®</div>
            <h3>You're Doing Well</h3>
            <p>Your nervous system seems fairly regulated today. Small acts of self-care will help maintain this balance.</p>
          </div>

          <div class="quick-tools">
            <h3>Quick Tools</h3>
            <div class="quick-tools-grid">
              <button class="quick-tool-btn" onclick="openBreathingModal('478')"><span class="tool-icon">ü´Å</span><span class="tool-label">Breathe</span></button>
              <button class="quick-tool-btn" onclick="switchToTab('grounding')"><span class="tool-icon">üå±</span><span class="tool-label">Ground</span></button>
              <button class="quick-tool-btn" onclick="switchToTab('battery')"><span class="tool-icon">üîã</span><span class="tool-label">Check Battery</span></button>
              <button class="quick-tool-btn" onclick="switchToTab('recovery')"><span class="tool-icon">üõ°Ô∏è</span><span class="tool-label">Recovery Mode</span></button>
            </div>
          </div>
        </div>

        <div class="tab-content" id="tab-breathing">
          <div class="breathing-section">
            <div class="breathing-intro">
              <h2>Breathing Exercises</h2>
              <p>Calm your nervous system with guided breathing techniques</p>
            </div>
            <div class="breathing-exercises">
              <div class="breathing-exercise-card" onclick="openBreathingModal('478')">
                <div class="exercise-info"><h4>4-7-8 Relaxing Breath</h4><p>Deeply calming technique for anxiety and sleep</p></div>
                <div class="exercise-meta"><span class="exercise-duration">‚è±Ô∏è 3 min</span><button class="exercise-start">Start</button></div>
              </div>
              <div class="breathing-exercise-card" onclick="openBreathingModal('box')">
                <div class="exercise-info"><h4>Box Breathing</h4><p>Equal counts to balance and center your energy</p></div>
                <div class="exercise-meta"><span class="exercise-duration">‚è±Ô∏è 4 min</span><button class="exercise-start">Start</button></div>
              </div>
              <div class="breathing-exercise-card" onclick="openBreathingModal('sigh')">
                <div class="exercise-info"><h4>Physiological Sigh</h4><p>Quick nervous system reset ‚Äî one breath can help</p></div>
                <div class="exercise-meta"><span class="exercise-duration">‚è±Ô∏è 1 min</span><button class="exercise-start">Start</button></div>
              </div>
              <div class="breathing-exercise-card" onclick="openBreathingModal('calm')">
                <div class="exercise-info"><h4>Calming Breath</h4><p>Simple technique for moments of overwhelm</p></div>
                <div class="exercise-meta"><span class="exercise-duration">‚è±Ô∏è 2 min</span><button class="exercise-start">Start</button></div>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-content" id="tab-battery">
          <div class="battery-section">
            <div class="battery-main-card">
              <div class="battery-visual"><div class="battery-body"><div class="battery-level" id="batteryLevel" style="height:100%"></div></div></div>
              <div class="battery-percentage">100%</div>
              <div class="battery-status">Fully charged ‚Äî you're ready for the day</div>
              <div class="battery-estimate"><span>‚ú®</span><span>Start logging activities to track your energy</span></div>
            </div>

            <div class="drains-section">
              <div class="drains-header"><h3>Recent Drains</h3><button class="log-drain-btn" onclick="openActivityModal()">+ Log Activity</button></div>
              <div class="drains-list">
                <div style="padding: 24px; text-align: center; color: var(--text-muted);">
                  <span style="font-size: 32px;">üìã</span>
                  <p style="margin-top: 8px;">No activities logged yet. Track social events to see how they affect your battery.</p>
                </div>
              </div>
            </div>

            <div class="predictions-card">
              <h3>üîÆ Predictions & Suggestions</h3>
              <div style="padding: 16px; text-align: center; color: var(--text-muted);">
                <p>Log activities over time to receive personalized insights and predictions.</p>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-content" id="tab-grounding">
          <div class="grounding-section">
            <div class="grounding-intro"><h2>Grounding Exercises</h2><p>Come back to the present moment when you feel disconnected</p></div>
            <div class="grounding-card">
              <h3>5-4-3-2-1 Technique</h3><p>Use your senses to anchor yourself in the present</p>
              <div class="grounding-steps">
                <div class="grounding-step"><span class="step-number">5</span><span class="step-text">things you can <span class="sense">SEE</span> üëÅÔ∏è</span></div>
                <div class="grounding-step"><span class="step-number">4</span><span class="step-text">things you can <span class="sense">TOUCH</span> ‚úã</span></div>
                <div class="grounding-step"><span class="step-number">3</span><span class="step-text">things you can <span class="sense">HEAR</span> üëÇ</span></div>
                <div class="grounding-step"><span class="step-number">2</span><span class="step-text">things you can <span class="sense">SMELL</span> üëÉ</span></div>
                <div class="grounding-step"><span class="step-number">1</span><span class="step-text">thing you can <span class="sense">TASTE</span> üëÖ</span></div>
              </div>
              <button class="btn-primary" onclick="startGroundingExercise()">Start Guided Exercise</button>
            </div>
            <div class="other-techniques">
              <div class="technique-card"><h4>ü¶∂ Feet on Floor</h4><p>Press your feet firmly into the ground. Feel the solid earth beneath you supporting your weight.</p></div>
              <div class="technique-card"><h4>üßä Cold Water Reset</h4><p>Splash cold water on your face or hold something cold. The sensation brings you back to now.</p></div>
              <div class="technique-card"><h4>ü§≤ Object Focus</h4><p>Hold a small object and describe it in detail ‚Äî texture, weight, temperature, color.</p></div>
              <div class="technique-card"><h4>üî¢ Counting Exercise</h4><p>Count backwards from 100 by 7s. The mental focus interrupts spiraling thoughts.</p></div>
            </div>
          </div>
        </div>

        <div class="tab-content" id="tab-recovery">
          <div class="recovery-section">
            <div class="recovery-hero">
              <div class="hero-icon">üõ°Ô∏è</div>
              <h2>Recovery Mode</h2>
              <p>When you're overwhelmed, this mode simplifies everything. Minimal stimulation, maximum restoration.</p>
              <div class="recovery-toggle" id="recoveryToggle" onclick="toggleRecoveryMode()">
                <span>Enable Recovery Mode</span>
                <div class="toggle-switch"></div>
              </div>
            </div>
            <div class="recovery-tools">
              <div class="recovery-tool-card">
                <div class="tool-icon">üåô</div>
                <h4>Do Nothing Permission</h4>
                <p>You don't have to be productive. Just existing is enough right now.</p>
                <span class="tool-time">Take all the time you need</span>
              </div>
              <div class="recovery-tool-card" onclick="openBreathingModal('calm')">
                <div class="tool-icon">üå¨Ô∏è</div>
                <h4>Gentle Breath</h4>
                <p>A simple, slow breathing exercise with no counting or pressure.</p>
                <span class="tool-time">‚è±Ô∏è 2 min</span>
              </div>
              <div class="recovery-tool-card">
                <div class="tool-icon">üéß</div>
                <h4>Ambient Soundscape</h4>
                <p>Soft rain, gentle wind, or quiet static to fill the silence without demanding attention.</p>
                <span class="tool-time">‚è±Ô∏è As long as needed</span>
              </div>
              <div class="recovery-tool-card">
                <div class="tool-icon">üìµ</div>
                <h4>Digital Boundaries</h4>
                <p>Suggested message to send: "Taking some quiet time. Will respond when I'm able. üíô"</p>
                <span class="tool-time">Copy to clipboard</span>
              </div>
            </div>
          </div>
        </div>

      </div>
    </main>
  </div>

  <!-- Activity Log Modal -->
  <div class="breathing-modal" id="activityModal">
    <div class="modal-overlay" onclick="closeActivityModal()"></div>
    <div class="modal-content" style="max-width: 500px;">
      <button class="close-modal" onclick="closeActivityModal()">‚úï</button>
      <h3 class="exercise-title">Log Activity</h3>
      <p class="exercise-description">What drained your social battery?</p>

      <div style="display: flex; flex-direction: column; gap: 16px; margin: 24px 0;">
        <div class="activity-options" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
          <button class="activity-option" onclick="selectActivity('meeting', 'üíº', 'Work Meeting', 15)">
            <span style="font-size: 28px;">üíº</span>
            <span>Work Meeting</span>
          </button>
          <button class="activity-option" onclick="selectActivity('call', 'üìû', 'Phone Call', 10)">
            <span style="font-size: 28px;">üìû</span>
            <span>Phone Call</span>
          </button>
          <button class="activity-option" onclick="selectActivity('social', 'üë•', 'Social Event', 25)">
            <span style="font-size: 28px;">üë•</span>
            <span>Social Event</span>
          </button>
          <button class="activity-option" onclick="selectActivity('family', 'üë®‚Äçüë©‚Äçüëß', 'Family Time', 15)">
            <span style="font-size: 28px;">üë®‚Äçüë©‚Äçüëß</span>
            <span>Family Time</span>
          </button>
          <button class="activity-option" onclick="selectActivity('shopping', 'üõí', 'Shopping', 10)">
            <span style="font-size: 28px;">üõí</span>
            <span>Shopping</span>
          </button>
          <button class="activity-option" onclick="selectActivity('conflict', 'üò§', 'Difficult Convo', 20)">
            <span style="font-size: 28px;">üò§</span>
            <span>Difficult Convo</span>
          </button>
        </div>

        <div style="text-align: center; color: var(--text-muted); font-size: 13px;">or</div>

        <input type="text" id="customActivityInput" placeholder="Type custom activity..." style="
          width: 100%;
          padding: 14px 18px;
          background: var(--bg-surface);
          border: 1px solid var(--border-subtle);
          border-radius: var(--radius-md);
          color: var(--text-primary);
          font-size: 15px;
        ">

        <div style="display: flex; align-items: center; gap: 12px;">
          <span style="color: var(--text-secondary); font-size: 14px;">Energy drain:</span>
          <input type="range" id="drainSlider" min="5" max="40" value="15" style="flex: 1;">
          <span id="drainValue" style="color: var(--accent-warm); font-weight: 500;">-15%</span>
        </div>
      </div>

      <button class="btn-primary" onclick="logActivity()" style="width: 100%;">Log Activity</button>
    </div>
  </div>

  <style>
    .activity-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding: 16px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .activity-option:hover {
      background: var(--bg-elevated);
      border-color: var(--accent-warm);
      color: var(--text-primary);
    }
    .activity-option.selected {
      background: rgba(232,168,124,0.15);
      border-color: var(--accent-warm);
      color: var(--text-primary);
    }
    #customActivityInput:focus {
      outline: none;
      border-color: var(--accent-warm);
    }
  </style>

  <div class="breathing-modal" id="breathingModal">
    <div class="modal-overlay" onclick="closeBreathingModal()"></div>
    <div class="modal-content">
      <button class="close-modal" onclick="closeBreathingModal()">‚úï</button>
      <div class="breath-visualization" id="breathVisualization">
        <div class="breath-circle-outer"></div>
        <div class="breath-circle-middle"></div>
        <div class="breath-circle-inner">
          <div class="breath-text" id="breathText">Ready</div>
          <div class="breath-count" id="breathCount"></div>
        </div>
      </div>
      <h3 class="exercise-title" id="exerciseTitle">4-7-8 Relaxing Breath</h3>
      <p class="exercise-description" id="exerciseDescription">Inhale for 4, hold for 7, exhale for 8</p>
      <div class="breath-steps-display" id="breathSteps">
        <div class="breath-step-item" id="step-inhale"><div class="breath-step-number">4</div><div class="breath-step-label">Inhale</div></div>
        <div class="breath-step-item" id="step-hold"><div class="breath-step-number">7</div><div class="breath-step-label">Hold</div></div>
        <div class="breath-step-item" id="step-exhale"><div class="breath-step-number">8</div><div class="breath-step-label">Exhale</div></div>
      </div>
      <div class="breathing-controls">
        <button class="btn-breathing" id="startBreathingBtn" onclick="startBreathing()">Begin Exercise</button>
        <button class="soundscape-toggle" id="soundscapeBtn" onclick="toggleSoundscape()"><span>üîä</span><span>Enable Soundscape</span></button>
      </div>
      <div class="cycle-counter" id="cycleCounter"></div>
      <div class="completion-message" id="completionMessage">
        <h4>üåü Beautiful work</h4>
        <p>You completed the exercise. Notice how your body feels now compared to before.</p>
      </div>
    </div>
  </div>

  <!-- Grounding Exercise Modal -->
  <div class="breathing-modal" id="groundingModal">
    <div class="modal-overlay" onclick="closeGroundingModal()"></div>
    <div class="modal-content">
      <button class="close-modal" onclick="closeGroundingModal()">‚úï</button>
      <div id="groundingExercise">
        <div class="grounding-exercise-display" id="groundingDisplay">
          <div class="grounding-sense-icon" id="groundingSenseIcon" style="background: rgba(124,184,232,0.2);">üëÅÔ∏è</div>
          <div class="grounding-sense-count" id="groundingSenseCount">5</div>
          <div class="grounding-sense-label" id="groundingSenseLabel">things you can SEE</div>
          <p class="grounding-prompt" id="groundingPrompt">Look around slowly. Name 5 things you can see right now.</p>
          <div class="grounding-progress" id="groundingProgress">
            <div class="grounding-progress-dot active"></div>
            <div class="grounding-progress-dot"></div>
            <div class="grounding-progress-dot"></div>
            <div class="grounding-progress-dot"></div>
            <div class="grounding-progress-dot"></div>
          </div>
          <button class="btn-grounding-next" id="groundingNextBtn" onclick="nextGroundingStep()">I'm ready ‚Äî next sense</button>
        </div>
        <div class="grounding-completion" id="groundingCompletion">
          <div style="font-size: 64px; margin-bottom: 20px;">üåø</div>
          <h3>You're grounded</h3>
          <p>You've reconnected with the present moment through all five senses. Notice how your body feels now compared to before.</p>
          <button class="btn-grounding-next" onclick="closeGroundingModal()" style="margin-top: 28px;">Done</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <script>
    // ============ SUPABASE INIT ============
    const SUPABASE_URL = 'https://inpziyxjznikinqqputz.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlucHppeXhqem5pa2lucXFwdXR6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0MzQ0MTcsImV4cCI6MjA4NDAxMDQxN30.5QoXaD5vNcuteEmwmo82l_OIklVbGGCRpNtV0PMuSyY';

    let db = null;
    let currentUser = null;

    try {
      db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    } catch (err) {
      console.error('Supabase init error:', err);
    }

    async function initAuth() {
      if (!db) return;
      try {
        const { data: { session } } = await db.auth.getSession();
        if (session) {
          currentUser = session.user;
        }
      } catch (err) {
        console.error('Auth error:', err);
      }
    }

    if (db) {
      db.auth.onAuthStateChange((event, session) => {
        if (session) {
          currentUser = session.user;
        } else {
          currentUser = null;
        }
      });
    }

    // ============ TAB NAVIGATION ============
    function switchToTab(tabId) {
      document.querySelectorAll('.wellness-tab').forEach(tab => tab.classList.remove('active'));
      const btn = document.querySelector(`.wellness-tab[onclick="switchToTab('${tabId}')"]`);
      if (btn) btn.classList.add('active');
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById(`tab-${tabId}`).classList.add('active');
    }

    // ============ BREATHING EXERCISES ============
    const breathingExercises = {
      '478': { title: '4-7-8 Relaxing Breath', description: 'Inhale for 4, hold for 7, exhale for 8', inhale: 4, hold: 7, exhale: 8, cycles: 4 },
      'box': { title: 'Box Breathing', description: 'Equal counts: inhale, hold, exhale, hold', inhale: 4, hold: 4, exhale: 4, holdAfter: 4, cycles: 4 },
      'sigh': { title: 'Physiological Sigh', description: 'Double inhale through nose, long exhale through mouth', inhale: 2, inhale2: 1, exhale: 6, cycles: 3 },
      'calm': { title: 'Calming Breath', description: 'Slow, gentle breathing with no pressure', inhale: 4, exhale: 6, cycles: 5 }
    };

    let currentExercise = null;
    let breathingInterval = null;
    let currentPhase = 'ready';
    let currentCount = 0;
    let currentCycle = 0;

    function openBreathingModal(exerciseId) {
      currentExercise = breathingExercises[exerciseId];
      document.getElementById('exerciseTitle').textContent = currentExercise.title;
      document.getElementById('exerciseDescription').textContent = currentExercise.description;
      document.querySelector('#step-inhale .breath-step-number').textContent = currentExercise.inhale;
      document.querySelector('#step-hold .breath-step-number').textContent = currentExercise.hold || '-';
      document.querySelector('#step-exhale .breath-step-number').textContent = currentExercise.exhale;
      document.getElementById('step-hold').style.display = currentExercise.hold ? 'flex' : 'none';
      resetBreathingState();
      document.getElementById('breathingModal').classList.add('active');
      // Tell parent to go fullscreen (desktop only)
      try { window.parent.postMessage({ action: 'breathingFullscreen', enabled: true }, '*'); } catch(e) {}
    }

    function closeBreathingModal() {
      document.getElementById('breathingModal').classList.remove('active');
      stopBreathing();
      stopSoundscape();
      resetBreathingState();
      // Tell parent to exit fullscreen
      try { window.parent.postMessage({ action: 'breathingFullscreen', enabled: false }, '*'); } catch(e) {}
    }

    function resetBreathingState() {
      currentPhase = 'ready'; currentCount = 0; currentCycle = 0;
      document.getElementById('breathText').textContent = 'Ready';
      document.getElementById('breathCount').textContent = '';
      document.getElementById('breathVisualization').className = 'breath-visualization';
      document.getElementById('cycleCounter').textContent = '';
      document.getElementById('completionMessage').classList.remove('show');
      document.getElementById('startBreathingBtn').disabled = false;
      document.getElementById('startBreathingBtn').textContent = 'Begin Exercise';
      document.querySelectorAll('.breath-step-item').forEach(step => step.classList.remove('active'));
    }

    function startBreathing() {
      if (breathingInterval || !currentExercise) return;
      document.getElementById('startBreathingBtn').disabled = true;
      document.getElementById('startBreathingBtn').textContent = 'In Progress...';
      currentCycle = 0;
      startInhale();
    }

    function stopBreathing() {
      if (breathingInterval) { clearInterval(breathingInterval); breathingInterval = null; }
    }

    function startInhale() {
      currentPhase = 'inhale'; currentCount = currentExercise.inhale;
      updateBreathDisplay('Inhale', currentCount);
      setActiveStep('inhale'); setVisualization('inhale');
      breathingInterval = setInterval(() => {
        currentCount--;
        if (currentCount > 0) document.getElementById('breathCount').textContent = currentCount;
        else { clearInterval(breathingInterval); currentExercise.hold ? startHold() : startExhale(); }
      }, 1000);
    }

    function startHold() {
      currentPhase = 'hold'; currentCount = currentExercise.hold;
      updateBreathDisplay('Hold', currentCount);
      setActiveStep('hold'); setVisualization('hold');
      breathingInterval = setInterval(() => {
        currentCount--;
        if (currentCount > 0) document.getElementById('breathCount').textContent = currentCount;
        else { clearInterval(breathingInterval); startExhale(); }
      }, 1000);
    }

    function startExhale() {
      currentPhase = 'exhale'; currentCount = currentExercise.exhale;
      updateBreathDisplay('Exhale', currentCount);
      setActiveStep('exhale'); setVisualization('exhale');
      breathingInterval = setInterval(() => {
        currentCount--;
        if (currentCount > 0) document.getElementById('breathCount').textContent = currentCount;
        else {
          clearInterval(breathingInterval);
          currentCycle++; updateCycleCounter();
          if (currentCycle >= currentExercise.cycles) completeExercise(); else startInhale();
        }
      }, 1000);
    }

    function updateBreathDisplay(text, count) {
      document.getElementById('breathText').textContent = text;
      document.getElementById('breathCount').textContent = count;
    }

    function setActiveStep(step) {
      document.querySelectorAll('.breath-step-item').forEach(s => s.classList.remove('active'));
      if (step === 'inhale') document.getElementById('step-inhale').classList.add('active');
      if (step === 'hold') document.getElementById('step-hold').classList.add('active');
      if (step === 'exhale') document.getElementById('step-exhale').classList.add('active');
    }

    function setVisualization(phase) {
      document.getElementById('breathVisualization').className = 'breath-visualization ' + phase;
    }

    function updateCycleCounter() {
      document.getElementById('cycleCounter').textContent = `Cycle ${currentCycle} of ${currentExercise.cycles}`;
    }

    function completeExercise() {
      currentPhase = 'complete';
      document.getElementById('breathText').textContent = 'Complete';
      document.getElementById('breathCount').textContent = '‚ú®';
      document.getElementById('breathVisualization').className = 'breath-visualization';
      document.querySelectorAll('.breath-step-item').forEach(step => step.classList.remove('active'));
      document.getElementById('completionMessage').classList.add('show');
      document.getElementById('startBreathingBtn').disabled = false;
      document.getElementById('startBreathingBtn').textContent = 'Do Again';
      // Stop soundscape on completion
      stopSoundscape();
    }

    // ============ 5-4-3-2-1 GROUNDING EXERCISE ============
    const groundingSteps = [
      { count: 5, sense: 'SEE',   icon: 'üëÅÔ∏è', prompt: 'Look around slowly. Name 5 things you can see right now.', color: 'rgba(124,184,232,0.2)' },
      { count: 4, sense: 'TOUCH', icon: '‚úã', prompt: 'Notice 4 things you can physically feel ‚Äî the chair, your clothes, the air on your skin.', color: 'rgba(196,161,255,0.2)' },
      { count: 3, sense: 'HEAR',  icon: 'üëÇ', prompt: 'Listen carefully. What 3 sounds can you hear? Near or far, loud or soft.', color: 'rgba(124,232,168,0.2)' },
      { count: 2, sense: 'SMELL', icon: 'üëÉ', prompt: 'Breathe in gently. Can you notice 2 distinct smells around you?', color: 'rgba(232,168,124,0.2)' },
      { count: 1, sense: 'TASTE', icon: 'üëÖ', prompt: 'Focus on your mouth. What 1 taste can you notice right now?', color: 'rgba(240,232,124,0.2)' }
    ];

    let groundingStep = 0;

    function startGroundingExercise() {
      groundingStep = 0;
      document.getElementById('groundingCompletion').classList.remove('show');
      document.getElementById('groundingDisplay').style.display = '';
      renderGroundingStep();
      document.getElementById('groundingModal').classList.add('active');
      try { window.parent.postMessage({ action: 'breathingFullscreen', enabled: true }, '*'); } catch(e) {}
    }

    function renderGroundingStep() {
      const step = groundingSteps[groundingStep];
      document.getElementById('groundingSenseIcon').textContent = step.icon;
      document.getElementById('groundingSenseIcon').style.background = step.color;
      document.getElementById('groundingSenseCount').textContent = step.count;
      document.getElementById('groundingSenseLabel').textContent = 'things you can ' + step.sense;
      document.getElementById('groundingPrompt').textContent = step.prompt;
      document.getElementById('groundingNextBtn').textContent =
        groundingStep < groundingSteps.length - 1 ? "I'm ready ‚Äî next sense" : "I'm done";

      // Update progress dots
      const dots = document.querySelectorAll('#groundingProgress .grounding-progress-dot');
      dots.forEach((dot, i) => {
        dot.className = 'grounding-progress-dot';
        if (i < groundingStep) dot.classList.add('done');
        else if (i === groundingStep) dot.classList.add('active');
      });
    }

    function nextGroundingStep() {
      groundingStep++;
      if (groundingStep >= groundingSteps.length) {
        completeGroundingExercise();
        return;
      }
      renderGroundingStep();
    }

    function completeGroundingExercise() {
      document.getElementById('groundingDisplay').style.display = 'none';
      document.getElementById('groundingCompletion').classList.add('show');
    }

    function closeGroundingModal() {
      document.getElementById('groundingModal').classList.remove('active');
      try { window.parent.postMessage({ action: 'breathingFullscreen', enabled: false }, '*'); } catch(e) {}
    }

    // ============ SOUNDSCAPE AUDIO (Web Audio API) ============
    let audioCtx = null;
    let soundscapeNodes = [];
    let soundscapeActive = false;

    function createAudioContext() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
      return audioCtx;
    }

    function startSoundscape() {
      const ctx = createAudioContext();
      soundscapeNodes = [];

      // --- Layer 1: Rain base (warm brown noise, low-pass filtered) ---
      const rainLen = 4 * ctx.sampleRate;
      const rainBuf = ctx.createBuffer(2, rainLen, ctx.sampleRate);
      for (let ch = 0; ch < 2; ch++) {
        const d = rainBuf.getChannelData(ch);
        let last = 0;
        for (let i = 0; i < rainLen; i++) {
          const w = Math.random() * 2 - 1;
          d[i] = (last + 0.02 * w) / 1.02;
          last = d[i];
          d[i] *= 3.5;
        }
      }
      const rainSrc = ctx.createBufferSource();
      rainSrc.buffer = rainBuf;
      rainSrc.loop = true;
      const rainLP = ctx.createBiquadFilter();
      rainLP.type = 'lowpass';
      rainLP.frequency.value = 800;
      rainLP.Q.value = 0.5;
      const rainGain = ctx.createGain();
      rainGain.gain.value = 0.18;
      rainSrc.connect(rainLP);
      rainLP.connect(rainGain);
      rainGain.connect(ctx.destination);
      rainSrc.start();
      soundscapeNodes.push(rainSrc, rainLP, rainGain);

      // --- Layer 2: Rain droplets (bandpass white noise, gentle patter) ---
      const dropLen = 3 * ctx.sampleRate;
      const dropBuf = ctx.createBuffer(2, dropLen, ctx.sampleRate);
      for (let ch = 0; ch < 2; ch++) {
        const d = dropBuf.getChannelData(ch);
        for (let i = 0; i < dropLen; i++) {
          d[i] = Math.random() * 2 - 1;
        }
      }
      const dropSrc = ctx.createBufferSource();
      dropSrc.buffer = dropBuf;
      dropSrc.loop = true;
      const dropBP = ctx.createBiquadFilter();
      dropBP.type = 'bandpass';
      dropBP.frequency.value = 4000;
      dropBP.Q.value = 0.3;
      const dropGain = ctx.createGain();
      dropGain.gain.value = 0.04;
      // Slow modulation for natural variation
      const dropLfo = ctx.createOscillator();
      dropLfo.type = 'sine';
      dropLfo.frequency.value = 0.15;
      const dropLfoGain = ctx.createGain();
      dropLfoGain.gain.value = 0.02;
      dropLfo.connect(dropLfoGain);
      dropLfoGain.connect(dropGain.gain);
      dropLfo.start();
      dropSrc.connect(dropBP);
      dropBP.connect(dropGain);
      dropGain.connect(ctx.destination);
      dropSrc.start();
      soundscapeNodes.push(dropSrc, dropBP, dropGain, dropLfo, dropLfoGain);

      // --- Layer 3: Ocean waves (deep brown noise with slow volume swell) ---
      const wavLen = 6 * ctx.sampleRate;
      const wavBuf = ctx.createBuffer(2, wavLen, ctx.sampleRate);
      for (let ch = 0; ch < 2; ch++) {
        const d = wavBuf.getChannelData(ch);
        let last = 0;
        for (let i = 0; i < wavLen; i++) {
          const w = Math.random() * 2 - 1;
          d[i] = (last + 0.01 * w) / 1.01;
          last = d[i];
          d[i] *= 5;
        }
      }
      const wavSrc = ctx.createBufferSource();
      wavSrc.buffer = wavBuf;
      wavSrc.loop = true;
      const wavLP = ctx.createBiquadFilter();
      wavLP.type = 'lowpass';
      wavLP.frequency.value = 300;
      wavLP.Q.value = 0.7;
      const wavGain = ctx.createGain();
      wavGain.gain.value = 0.10;
      // Slow swell mimicking ocean waves
      const wavLfo = ctx.createOscillator();
      wavLfo.type = 'sine';
      wavLfo.frequency.value = 0.08;
      const wavLfoGain = ctx.createGain();
      wavLfoGain.gain.value = 0.06;
      wavLfo.connect(wavLfoGain);
      wavLfoGain.connect(wavGain.gain);
      wavLfo.start();
      wavSrc.connect(wavLP);
      wavLP.connect(wavGain);
      wavGain.connect(ctx.destination);
      wavSrc.start();
      soundscapeNodes.push(wavSrc, wavLP, wavGain, wavLfo, wavLfoGain);

      soundscapeActive = true;
    }

    function stopSoundscape() {
      soundscapeNodes.forEach(node => {
        try {
          if (node.stop) node.stop();
          if (node.disconnect) node.disconnect();
        } catch(e) {}
      });
      soundscapeNodes = [];
      soundscapeActive = false;
      // Update button state
      const btn = document.getElementById('soundscapeBtn');
      if (btn) {
        btn.classList.remove('active');
        btn.innerHTML = '<span>üîä</span><span>Enable Soundscape</span>';
      }
    }

    function toggleSoundscape() {
      const btn = document.getElementById('soundscapeBtn');
      if (soundscapeActive) {
        stopSoundscape();
      } else {
        startSoundscape();
        btn.classList.add('active');
        btn.innerHTML = '<span>üîá</span><span>Disable Soundscape</span>';
      }
    }

    // ============ RECOVERY MODE ============
    let recoveryModeActive = false;
    function toggleRecoveryMode() {
      recoveryModeActive = !recoveryModeActive;
      const toggle = document.getElementById('recoveryToggle');
      if (recoveryModeActive) {
        toggle.classList.add('active');
        document.body.style.filter = 'saturate(0.7) brightness(0.9)';
      } else {
        toggle.classList.remove('active');
        document.body.style.filter = 'none';
      }
    }

    // ============ SOCIAL BATTERY & ACTIVITY LOGGING ============
    let currentBattery = 100;
    let activities = [];
    let allActivities = []; // All historical activities for predictions
    let selectedActivityData = null;

    // Load battery from localStorage (for daily state) + Supabase (for history)
    async function loadBatteryData() {
      // Load today's battery level from localStorage
      const saved = localStorage.getItem('socialBattery');
      if (saved) {
        const data = JSON.parse(saved);
        if (data.date !== new Date().toDateString()) {
          currentBattery = 100;
          activities = [];
          saveBatteryLocal();
        } else {
          currentBattery = data.battery;
          activities = data.activities || [];
        }
      }

      // Load persisted activities from Supabase
      if (db && currentUser) {
        try {
          // Load today's activities
          const todayStart = new Date();
          todayStart.setHours(0, 0, 0, 0);

          const { data: todayData, error: todayErr } = await db
            .from('battery_activities')
            .select('*')
            .eq('user_id', currentUser.id)
            .gte('logged_at', todayStart.toISOString())
            .order('logged_at', { ascending: false });

          if (!todayErr && todayData && todayData.length > 0) {
            activities = todayData.map(a => ({
              id: a.id,
              name: a.name,
              icon: a.icon,
              drain: a.drain,
              time: new Date(a.logged_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
              logged_at: a.logged_at
            }));
            // Recalculate battery from today's activities
            currentBattery = Math.max(0, 100 - activities.reduce((sum, a) => sum + a.drain, 0));
            saveBatteryLocal();
          }

          // Load all historical activities for predictions
          const { data: allData, error: allErr } = await db
            .from('battery_activities')
            .select('*')
            .eq('user_id', currentUser.id)
            .order('logged_at', { ascending: false })
            .limit(100);

          if (!allErr && allData) {
            allActivities = allData;
          }
        } catch (err) {
          console.error('Load activities error:', err);
        }
      }

      updateBatteryDisplay();
      renderActivities();
      generatePredictions();
    }

    function saveBatteryLocal() {
      localStorage.setItem('socialBattery', JSON.stringify({
        date: new Date().toDateString(),
        battery: currentBattery,
        activities: activities
      }));
    }

    function openActivityModal() {
      document.getElementById('activityModal').classList.add('active');
      document.getElementById('customActivityInput').value = '';
      document.getElementById('drainSlider').value = 15;
      document.getElementById('drainValue').textContent = '-15%';
      selectedActivityData = null;
      document.querySelectorAll('.activity-option').forEach(o => o.classList.remove('selected'));
    }

    function closeActivityModal() {
      document.getElementById('activityModal').classList.remove('active');
    }

    function selectActivity(id, icon, name, drain) {
      selectedActivityData = { id, icon, name, drain };
      document.getElementById('drainSlider').value = drain;
      document.getElementById('drainValue').textContent = '-' + drain + '%';
      document.getElementById('customActivityInput').value = '';
      document.querySelectorAll('.activity-option').forEach(o => o.classList.remove('selected'));
      event.target.closest('.activity-option').classList.add('selected');
    }

    // Update drain value display when slider changes
    document.getElementById('drainSlider').addEventListener('input', function() {
      document.getElementById('drainValue').textContent = '-' + this.value + '%';
    });

    async function logActivity() {
      const customInput = document.getElementById('customActivityInput').value.trim();
      const drain = parseInt(document.getElementById('drainSlider').value);

      let activityName, activityIcon;

      if (customInput) {
        activityName = customInput;
        activityIcon = 'üìã';
      } else if (selectedActivityData) {
        activityName = selectedActivityData.name;
        activityIcon = selectedActivityData.icon;
      } else {
        showToast('Please select or enter an activity');
        return;
      }

      const now = new Date();
      const activity = {
        name: activityName,
        icon: activityIcon,
        drain: drain,
        time: now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
        logged_at: now.toISOString()
      };

      // Save to Supabase if authenticated
      if (db && currentUser) {
        try {
          const { data, error } = await db
            .from('battery_activities')
            .insert({
              user_id: currentUser.id,
              name: activityName,
              icon: activityIcon,
              drain: drain,
              logged_at: now.toISOString()
            })
            .select();

          if (error) {
            console.error('Save activity error:', error);
            showToast('Activity logged locally (sync issue)');
          } else if (data && data[0]) {
            activity.id = data[0].id;
          }

          // Update allActivities for predictions
          allActivities.unshift({
            id: activity.id,
            name: activityName,
            icon: activityIcon,
            drain: drain,
            logged_at: now.toISOString(),
            user_id: currentUser.id
          });
        } catch (err) {
          console.error('Save activity exception:', err);
        }
      }

      // Add to local list
      activities.unshift(activity);
      currentBattery = Math.max(0, currentBattery - drain);

      saveBatteryLocal();
      updateBatteryDisplay();
      renderActivities();
      generatePredictions();
      closeActivityModal();
    }

    function updateBatteryDisplay() {
      document.getElementById('batteryLevel').style.height = currentBattery + '%';
      document.querySelector('.battery-percentage').textContent = currentBattery + '%';

      let status = 'Fully charged ‚Äî you\'re ready for the day';
      if (currentBattery < 20) status = 'Very low ‚Äî prioritize rest and solitude';
      else if (currentBattery < 40) status = 'Running low ‚Äî consider taking a break';
      else if (currentBattery < 60) status = 'Moderate ‚Äî pace yourself';
      else if (currentBattery < 80) status = 'Good energy ‚Äî some capacity remaining';

      document.querySelector('.battery-status').textContent = status;

      // Update overview card too
      const overviewBattery = document.querySelector('#tab-overview .status-card:nth-child(2)');
      if (overviewBattery) {
        overviewBattery.querySelector('.status-value').textContent = currentBattery + '%';
        overviewBattery.querySelector('.status-bar-fill').style.width = currentBattery + '%';
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function renderActivities() {
      const container = document.querySelector('.drains-list');

      if (activities.length === 0) {
        container.innerHTML = `
          <div style="padding: 24px; text-align: center; color: var(--text-muted);">
            <span style="font-size: 32px;">üìã</span>
            <p style="margin-top: 8px;">No activities logged yet. Track social events to see how they affect your battery.</p>
          </div>
        `;
        return;
      }

      container.innerHTML = activities.slice(0, 5).map(activity => `
        <div class="drain-item">
          <div class="drain-icon">${activity.icon}</div>
          <div class="drain-details">
            <div class="drain-name">${escapeHtml(activity.name)}</div>
            <div class="drain-time">${activity.time}</div>
          </div>
          <div class="drain-impact">-${activity.drain}%</div>
        </div>
      `).join('');
    }

    // ============ PREDICTIONS & SUGGESTIONS ENGINE ============
    function generatePredictions() {
      const container = document.querySelector('.predictions-card');
      const data = allActivities.length > 0 ? allActivities : activities;

      if (data.length < 3) {
        container.innerHTML = `
          <h3>üîÆ Predictions & Suggestions</h3>
          <div style="padding: 16px; text-align: center; color: var(--text-muted);">
            <p>Log at least 3 activities to receive personalized insights and predictions.</p>
            <p style="margin-top: 8px; font-size: 13px;">${data.length}/3 activities logged</p>
          </div>
        `;
        return;
      }

      const insights = [];

      // --- Analysis 1: Top draining activities ---
      const activityCounts = {};
      const activityTotalDrain = {};
      data.forEach(a => {
        const name = a.name;
        activityCounts[name] = (activityCounts[name] || 0) + 1;
        activityTotalDrain[name] = (activityTotalDrain[name] || 0) + a.drain;
      });

      const sortedByFrequency = Object.entries(activityCounts)
        .sort((a, b) => b[1] - a[1]);

      if (sortedByFrequency.length > 0) {
        const topDrain = sortedByFrequency[0];
        insights.push({
          icon: 'üìä',
          text: `<strong>${escapeHtml(topDrain[0])}</strong> is your most frequent drain, logged ${topDrain[1]} time${topDrain[1] > 1 ? 's' : ''}. Consider scheduling recovery time after.`
        });
      }

      // --- Analysis 2: Average daily drain ---
      const dayMap = {};
      data.forEach(a => {
        const day = new Date(a.logged_at).toDateString();
        dayMap[day] = (dayMap[day] || 0) + a.drain;
      });
      const days = Object.values(dayMap);
      if (days.length > 0) {
        const avgDrain = Math.round(days.reduce((s, d) => s + d, 0) / days.length);
        insights.push({
          icon: '‚ö°',
          text: `You typically lose about <strong>${avgDrain}%</strong> battery per day. ${avgDrain > 60 ? 'That\'s quite high ‚Äî try to protect some alone time.' : avgDrain > 40 ? 'That\'s moderate ‚Äî good awareness helps you pace yourself.' : 'That\'s well managed ‚Äî you\'re pacing yourself nicely.'}`
        });
      }

      // --- Analysis 3: Highest single drain ---
      const sortedByAvgDrain = Object.entries(activityTotalDrain)
        .map(([name, total]) => ({ name, avg: Math.round(total / activityCounts[name]) }))
        .sort((a, b) => b.avg - a.avg);

      if (sortedByAvgDrain.length > 1) {
        const heaviest = sortedByAvgDrain[0];
        insights.push({
          icon: 'üîã',
          text: `<strong>${escapeHtml(heaviest.name)}</strong> drains the most energy (avg -${heaviest.avg}%). Try to limit this when your battery is already low.`
        });
      }

      // --- Analysis 4: Time-of-day pattern (10+ activities) ---
      if (data.length >= 10) {
        const hourBuckets = { morning: 0, afternoon: 0, evening: 0 };
        data.forEach(a => {
          const hour = new Date(a.logged_at).getHours();
          if (hour < 12) hourBuckets.morning++;
          else if (hour < 17) hourBuckets.afternoon++;
          else hourBuckets.evening++;
        });
        const peak = Object.entries(hourBuckets).sort((a, b) => b[1] - a[1])[0];
        const peakLabel = peak[0].charAt(0).toUpperCase() + peak[0].slice(1);
        insights.push({
          icon: 'üïê',
          text: `Most of your draining activities happen in the <strong>${peakLabel.toLowerCase()}</strong>. Try to protect ${peak[0] === 'morning' ? 'your mornings' : peak[0] === 'afternoon' ? 'afternoon quiet time' : 'your evenings'} for recharging.`
        });
      }

      // --- Analysis 5: Day-of-week pattern (10+ activities) ---
      if (data.length >= 10) {
        const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const dayBuckets = {};
        data.forEach(a => {
          const day = dayNames[new Date(a.logged_at).getDay()];
          dayBuckets[day] = (dayBuckets[day] || 0) + 1;
        });
        const busiestDay = Object.entries(dayBuckets).sort((a, b) => b[1] - a[1])[0];
        if (busiestDay) {
          insights.push({
            icon: 'üìÖ',
            text: `<strong>${busiestDay[0]}s</strong> tend to be your most draining days. Consider planning lighter schedules or buffer time.`
          });
        }
      }

      // --- Analysis 6: Recovery suggestion ---
      if (currentBattery < 40) {
        insights.push({
          icon: 'üåø',
          text: `Your battery is at <strong>${currentBattery}%</strong>. A breathing exercise or some quiet solitude can help restore energy. Be gentle with yourself.`
        });
      }

      // Render predictions
      container.innerHTML = `
        <h3>üîÆ Predictions & Suggestions</h3>
        ${insights.map(i => `
          <div class="prediction-item">
            <span class="prediction-icon">${i.icon}</span>
            <span class="prediction-text">${i.text}</span>
          </div>
        `).join('')}
      `;
    }

    // ============ TOAST NOTIFICATION ============
    function showToast(message) {
      let toast = document.getElementById('toast');
      if (!toast) {
        toast = document.createElement('div');
        toast.id = 'toast';
        toast.style.cssText = `
          position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(100px);
          padding: 14px 28px; background: rgba(255,255,255,0.95); color: var(--bg-deep);
          border-radius: 100px; font-size: 14px; opacity: 0; transition: all 0.4s ease; z-index: 3000;
        `;
        document.body.appendChild(toast);
      }
      toast.textContent = message;
      toast.style.transform = 'translateX(-50%) translateY(0)';
      toast.style.opacity = '1';
      setTimeout(() => {
        toast.style.transform = 'translateX(-50%) translateY(100px)';
        toast.style.opacity = '0';
      }, 2500);
    }

    // ============ APPEARANCE SETTINGS ============
    function applyAppearanceSettings() {
      const theme = localStorage.getItem('theme') || 'dark';
      document.body.classList.add('theme-' + theme);

      if (localStorage.getItem('reduceAnimations') === 'true') {
        document.body.classList.add('reduce-motion');
      }

      const fontSize = localStorage.getItem('fontSize') || 'medium';
      document.body.classList.add('font-' + fontSize);
    }

    // ============ INITIALIZE ============
    async function initWellness() {
      applyAppearanceSettings();
      await initAuth();
      await loadBatteryData();
    }

    initWellness();
  </script>
</body>
</html>

